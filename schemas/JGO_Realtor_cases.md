# ЖильеGO - Сценарии использования системы
# Часть 2: Роль "Риелтор (Администратор)"

## Роль: Риелтор (Администратор)

**Описание роли:**
Риелтор - это владелец недвижимости или представитель, который:
- Добавляет свои объекты жилья в систему
- Управляет своими объектами (редактирование, деактивация)
- Просматривает бронирования своих объектов
- Получает уведомления о новых бронях
- Видит аналитику по своим объектам
- Общается с гостями

**Доступные интерфейсы:**
- Веб-приложение (админ-панель)
- Telegram-бот (расширенное меню)

**Права доступа:**
- ✅ Все возможности обычного пользователя
- ✅ Управление своими объектами
- ✅ Просмотр броней своих объектов
- ✅ Аналитика по своим объектам
- ❌ Доступ к объектам других риелторов
- ❌ Общая аналитика системы

---

## 1. Управление объектами недвижимости

### Сценарий 1.1: Добавление нового объекта (веб-интерфейс)

**Предусловия:** 
- Риелтор авторизован
- Имеет роль "Риелтор" или выше

**Основной поток:**

**Шаг 1: Переход к добавлению**
1. Риелтор переходит в "Панель риелтора" → "Мои объекты"
2. Нажимает кнопку "➕ Добавить квартиру"
3. Система открывает форму добавления

**Шаг 2: Основная информация**
4. Система показывает форму (Step 1 из 5):
   ```
   Добавление объекта - Шаг 1: Основная информация
   
   ┌─────────────────────────────────────────────┐
   │ Название объекта *                          │
   ├─────────────────────────────────────────────┤
   │ [_______________________________________]   │
   │ Например: "Уютная 2-комнатная в центре"    │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Местоположение *                            │
   ├─────────────────────────────────────────────┤
   │ Город:    [Астана ▼]                        │
   │ Район:    [Выберите район ▼]                │
   │ Улица:    [_______________________________] │
   │ Дом:      [____]  Подъезд: [__]             │
   │ Этаж:     [__]    Этажность: [__]           │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Тип и характеристики *                      │
   ├─────────────────────────────────────────────┤
   │ Тип жилья: [Квартира ▼]                     │
   │            (Квартира/Дом/Коттедж/Комната/   │
   │             Хостел)                          │
   │                                             │
   │ Класс:     [Бизнес ▼]                       │
   │            (Комфорт/Бизнес/Премиум)         │
   │                                             │
   │ Комнат:    [2 ▼]  (1/2/3/4+)                │
   │ Площадь:   [___] м²                         │
   │ Спальных мест: [__]                         │
   └─────────────────────────────────────────────┘
   
   [Отмена] [Далее: Описание →]
   ```

5. Риелтор заполняет обязательные поля
6. Нажимает "Далее"

**Шаг 3: Описание и удобства**
7. Система показывает форму (Step 2 из 5):
   ```
   Добавление объекта - Шаг 2: Описание и удобства
   
   ┌─────────────────────────────────────────────┐
   │ Описание объекта *                          │
   ├─────────────────────────────────────────────┤
   │ [                                          ]│
   │ [                                          ]│
   │ [                                          ]│
   │ [                                          ]│
   │ [                                          ]│
   │                                             │
   │ Минимум 100 символов                        │
   │ Введено: 0 / 2000                           │
   │                                             │
   │ 💡 Опишите:                                 │
   │ • Особенности жилья                         │
   │ • Что есть на кухне                         │
   │ • Состояние ремонта                         │
   │ • Что рядом (магазины, транспорт)           │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Удобства (выберите все подходящие)          │
   ├─────────────────────────────────────────────┤
   │ Основные:                                   │
   │ ☑ Wi-Fi                 ☑ Кухня             │
   │ ☑ Стиральная машина     ☐ Посудомоечная     │
   │ ☑ Телевизор             ☑ Кондиционер       │
   │ ☐ Отопление             ☐ Фен               │
   │                                             │
   │ Дополнительно:                              │
   │ ☑ Парковка              ☐ Лифт              │
   │ ☐ Балкон/Терраса        ☐ Можно с детьми    │
   │ ☐ Можно с питомцами     ☐ Для курящих       │
   │ ☐ Шумоизоляция          ☐ Рабочее место     │
   └─────────────────────────────────────────────┘
   
   [← Назад] [Далее: Цены →]
   ```

8. Риелтор вводит описание (минимум 100 символов)
9. Выбирает удобства
10. Нажимает "Далее"

**Шаг 4: Цены и правила**
11. Система показывает форму (Step 3 из 5):
    ```
    Добавление объекта - Шаг 3: Цены и правила
    
    ┌─────────────────────────────────────────────┐
    │ Стоимость аренды *                          │
    ├─────────────────────────────────────────────┤
    │ Цена за сутки: [_______] ₸                  │
    │                                             │
    │ 💡 Рекомендуемая цена для вашего района:    │
    │    4500-6000 ₸/сутки                        │
    └─────────────────────────────────────────────┘
    
    ┌─────────────────────────────────────────────┐
    │ Правила проживания                          │
    ├─────────────────────────────────────────────┤
    │ Время заезда:  [14:00 ▼] - [21:00 ▼]       │
    │ Время выезда:  [10:00 ▼] - [12:00 ▼]       │
    │                                             │
    │ Минимальный срок: [1 ▼] ночь               │
    │ Максимальный срок: [30 ▼] ночей            │
    │                                             │
    │ Правила отмены:                             │
    │ ○ Гибкие (возврат 100% за 3+ дня)          │
    │ ○ Умеренные (возврат 50% за 1-3 дня)       │
    │ ○ Строгие (возврат только за 7+ дней)      │
    │                                             │
    │ Дополнительные правила:                     │
    │ [_______________________________________]   │
    │ [_______________________________________]   │
    └─────────────────────────────────────────────┘
    
    [← Назад] [Далее: Фотографии →]
    ```

12. Риелтор устанавливает цену
13. Настраивает время заезда/выезда
14. Выбирает правила отмены
15. Нажимает "Далее"

**Шаг 5: Фотографии**
16. Система показывает форму (Step 4 из 5):
    ```
    Добавление объекта - Шаг 4: Фотографии
    
    ┌─────────────────────────────────────────────┐
    │ Фотографии объекта *                        │
    ├─────────────────────────────────────────────┤
    │ Загрузите от 3 до 6 фотографий              │
    │ Максимальный размер: 7 МБ каждое            │
    │ Форматы: JPG, PNG                           │
    │                                             │
    │ 💡 Советы для хороших фото:                 │
    │ • Фото при хорошем освещении                │
    │ • Чистая и убранная квартира                │
    │ • Все комнаты и ключевые зоны               │
    │ • Главное фото - самое привлекательное      │
    │                                             │
    │ [📤 Выбрать фотографии]                     │
    │                                             │
    │ Загруженные фото (3/6):                     │
    │                                             │
    │ ┌─────┐ ┌─────┐ ┌─────┐                    │
    │ │[📷] │ │[📷] │ │[📷] │                    │
    │ │ 1   │ │ 2   │ │ 3   │                    │
    │ │⭐Гл │ │     │ │     │                    │
    │ └─────┘ └─────┘ └─────┘                    │
    │ [❌][↑][↓] [❌][↑][↓] [❌][↑][↓]            │
    │                                             │
    │ [+ Добавить еще фото]                       │
    └─────────────────────────────────────────────┘
    
    [← Назад] [Далее: Инструкции →]
    ```

17. Риелтор загружает минимум 3 фотографии
18. Может изменить порядок (стрелками)
19. Может удалить фото (❌)
20. Может пометить главное фото (⭐)
21. Система валидирует:
    - Минимум 3, максимум 6 фото
    - Размер каждого ≤ 7 МБ
    - Формат JPG или PNG
22. Нажимает "Далее"

**Шаг 6: Инструкции доступа**
23. Система показывает форму (Step 5 из 5):
    ```
    Добавление объекта - Шаг 5: Инструкции доступа
    
    ┌─────────────────────────────────────────────┐
    │ Информация для гостей *                     │
    ├─────────────────────────────────────────────┤
    │ Код домофона: [______]                      │
    │ Код квартиры: [______]                      │
    │                                             │
    │ 🔒 Эта информация будет доступна гостям     │
    │    только после оплаты бронирования         │
    └─────────────────────────────────────────────┘
    
    ┌─────────────────────────────────────────────┐
    │ Инструкция по заселению                     │
    ├─────────────────────────────────────────────┤
    │ [                                          ]│
    │ [                                          ]│
    │ [                                          ]│
    │                                             │
    │ Например:                                   │
    │ "При входе в подъезд наберите код 1234.     │
    │  Поднимитесь на 7 этаж. Квартира 71.        │
    │  Код от квартиры 5678. Ключи на столе       │
    │  в прихожей..."                             │
    └─────────────────────────────────────────────┘
    
    ┌─────────────────────────────────────────────┐
    │ Контакты для экстренной связи *             │
    ├─────────────────────────────────────────────┤
    │ Ваш телефон: [+7 (___) ___-__-__]          │
    │ Доп. телефон: [+7 (___) ___-__-__]         │
    │              (опционально)                  │
    │                                             │
    │ Telegram: [@_____________]                  │
    │          (опционально)                      │
    └─────────────────────────────────────────────┘
    
    [← Назад] [✅ Сохранить и опубликовать]
    ```

24. Риелтор вводит:
    - Код домофона
    - Код квартиры/электронного замка
    - Подробную инструкцию
    - Контактный телефон
    - Опционально: доп. телефон и Telegram

**Шаг 7: Финальное подтверждение**
25. Риелтор нажимает "✅ Сохранить и опубликовать"
26. Система показывает предпросмотр:
    ```
    Предпросмотр объекта
    
    Вот как будет выглядеть ваш объект для гостей:
    
    [Превью карточки объекта - как видят пользователи]
    
    Всё верно?
    
    ☑ Я подтверждаю, что вся информация верна
    ☑ Я владелец объекта или имею право сдавать его
    
    [← Вернуться к редактированию]
    [✅ Опубликовать объект]
    ```

27. Риелтор проверяет данные
28. Ставит галочки подтверждения
29. Нажимает "✅ Опубликовать"

**Шаг 8: Сохранение**
30. Система в транзакции:
    ```python
    with transaction.atomic():
        # Создаем объект
        property = Property.objects.create(
            owner=realtor,
            name=name,
            address=address,
            city=city,
            district=district,
            property_type=property_type,
            property_class=property_class,
            rooms=rooms,
            area=area,
            beds=beds,
            description=description,
            price_per_night=price,
            status='ACTIVE'
        )
        
        # Сохраняем удобства
        property.amenities.add(*amenities)
        
        # Загружаем фото в Minio
        for i, photo in enumerate(photos):
            photo_url = upload_to_minio(
                photo, 
                f'properties/{property.id}/{i}.jpg'
            )
            PropertyPhoto.objects.create(
                property=property,
                url=photo_url,
                order=i,
                is_main=(i == 0)
            )
        
        # Создаем календарь доступности
        PropertyCalendar.objects.create(
            property=property,
            available_from=today,
            available_to=today + timedelta(days=365)
        )
        
        # Сохраняем инструкции (шифруем)
        AccessInfo.objects.create(
            property=property,
            door_code=encrypt(door_code),
            apartment_code=encrypt(apartment_code),
            instructions=instructions,
            contact_phone=phone
        )
        
        # Логируем создание
        log_action(
            user=realtor,
            action='PROPERTY_CREATED',
            property_id=property.id
        )
        
        # Уведомляем модераторов (если есть модерация)
        notify_moderators.delay(property.id)
    ```

31. Система показывает успех:
    ```
    ✅ Объект успешно добавлен!
    
    Ваш объект "Уютная 2-комнатная в центре" 
    опубликован и доступен для бронирования.
    
    🔢 ID объекта: #12345
    📍 Адрес: г. Астана, ул. Кабанбай батыра, 12
    💰 Цена: 5000 ₸/ночь
    
    Что дальше?
    
    [👀 Посмотреть на сайте]
    [✏️ Редактировать]
    [➕ Добавить еще объект]
    [📋 К моим объектам]
    ```

**Альтернативные потоки:**

**1a. Не все обязательные поля заполнены:**
- Система подсвечивает незаполненные поля красным
- Показывает ошибку: "Заполните все обязательные поля"
- Не позволяет перейти к следующему шагу

**1b. Слишком короткое описание (<100 символов):**
```
❌ Описание слишком короткое

Минимум 100 символов
Сейчас: 45 символов

Добавьте больше деталей о вашем жилье
```

**1c. Загружено менее 3 фотографий:**
```
❌ Недостаточно фотографий

Загрузите минимум 3 фотографии
Сейчас: 2 фотографии

Хорошие фото увеличивают количество броней!
```

**1d. Фото слишком большое (>7 МБ):**
```
❌ Файл слишком большой

Файл "IMG_1234.jpg": 12.5 МБ
Максимальный размер: 7 МБ

Пожалуйста, сожмите изображение или выберите другое

[Выбрать другое] [Помощь по сжатию]
```

**1e. Неверный формат фото:**
```
❌ Неподдерживаемый формат

Файл "photo.gif" имеет неверный формат
Поддерживаются только: JPG, PNG

[Выбрать другое]
```

**1f. Некорректная цена:**
```
⚠️ Необычная цена

Вы указали: 500 ₸/ночь

Это очень низкая цена. Средняя цена в вашем
районе: 4500-6000 ₸/ночь

Вы уверены?

[Да, оставить 500 ₸] [Изменить цену]
```

**1g. Технический сбой при загрузке:**
```
❌ Ошибка сохранения

Не удалось сохранить объект.
Пожалуйста, попробуйте еще раз.

Если проблема повторяется, свяжитесь с поддержкой.

[🔄 Попробовать снова] [☎️ Связаться с поддержкой]
```

**Постусловия:**
- Объект создан и опубликован
- Доступен для бронирования пользователями
- Фото загружены в Minio
- Коды доступа зашифрованы
- Создан календарь доступности
- Логирование выполнено

---

### Сценарий 1.2: Добавление объекта через Telegram-бот

**Предусловия:**
- Риелтор авторизован в боте
- Имеет роль "Риелтор"

**Основной поток:**

**Шаг 1: Инициация**
1. Риелтор в главном меню нажимает "🏢 Панель Администратора"
2. Бот показывает админ-меню:
   ```
   🏢 Панель Администратора
   
   Управление вашими объектами
   
   [➕ Добавить квартиру]
   [🏠 Мои квартиры (5)]
   [📊 Статистика]
   
   [🏠 Главное меню]
   ```
3. Риелтор нажимает "➕ Добавить квартиру"

**Шаг 2-15: Пошаговый ввод данных**
4. Бот последовательно запрашивает информацию:

**Название:**
```
Добавление квартиры - Шаг 1/11

Введите название объекта:

Например: "Уютная 2-комнатная в центре"

[❌ Отмена]
```

**Город и район:**
```
Шаг 2/11: Город

Выберите город:

[Астана]

[⬅️ Назад] [❌ Отмена]
```

```
Шаг 3/11: Район

Выберите район:

[Алматинский] [Есильский]
[Сарыаркинский] [Байконырский]

[⬅️ Назад] [❌ Отмена]
```

**Адрес:**
```
Шаг 4/11: Адрес

Введите адрес:

Формат: ул. Название, дом X, подъезд Y, этаж Z

Например: ул. Кабанбай батыра, 12, подъезд 2, этаж 7

[⬅️ Назад] [❌ Отмена]
```

**Тип и класс:**
```
Шаг 5/11: Тип жилья

Выберите тип:

[🏠 Квартира] [🏡 Дом] [🏘 Коттедж]
[🚪 Комната] [🏨 Хостел]

[⬅️ Назад] [❌ Отмена]
```

```
Шаг 6/11: Класс жилья

Выберите класс:

[Комфорт] [Бизнес] [Премиум]

[⬅️ Назад] [❌ Отмена]
```

**Характеристики:**
```
Шаг 7/11: Количество комнат

Введите количество комнат: 1, 2, 3 или 4+

[1] [2] [3] [4+]

[⬅️ Назад] [❌ Отмена]
```

**Описание:**
```
Шаг 8/11: Описание

Опишите ваше жилье:

Минимум 100 символов

Расскажите о:
• Особенностях жилья
• Состоянии ремонта
• Что рядом

[⬅️ Назад] [❌ Отмена]
```

**Цена:**
```
Шаг 9/11: Цена

Введите цену за сутки в тенге:

Например: 5000

💡 Рекомендуемая цена: 4500-6000 ₸

[⬅️ Назад] [❌ Отмена]
```

**Фотографии:**
```
Шаг 10/11: Фотографии

Отправьте фотографии квартиры

📷 Минимум 3, максимум 6 фото
📏 Размер до 7 МБ каждое

Отправлено: 0/6

💡 Отправляйте по одной фотографии
   Первое фото будет главным

[✅ Готово (минимум 3)] [❌ Отмена]
```

Риелтор отправляет фото одно за другим:
```
Фото 1 получено ✓
Отправлено: 1/6

Продолжайте отправлять фото

[✅ Готово (минимум 3)] [❌ Отмена]
```

```
Фото 2 получено ✓
Фото 3 получено ✓
Отправлено: 3/6

Можно завершить или добавить еще

[✅ Готово] [Добавить еще (до 6)]
[❌ Отмена]
```

**Инструкции доступа:**
```
Шаг 11/11: Инструкции

Введите код домофона:

[⬅️ Назад] [❌ Отмена]
```

```
Код домофона: 1234

Введите код квартиры:

[⬅️ Назад] [❌ Отмена]
```

```
Код домофона: 1234
Код квартиры: 5678

Введите инструкцию по заселению:

Как гостю найти и войти в квартиру

[⬅️ Назад] [❌ Отмена]
```

**Финальное подтверждение:**
16. Бот показывает сводку:
    ```
    Проверьте данные
    
    📝 Название: Уютная 2-комнатная
    📍 Адрес: г. Астана, Есильский район,
              ул. Кабанбай батыра, 12
    🏠 Тип: Квартира (Бизнес класс)
    🛏 Комнат: 2
    💰 Цена: 5000 ₸/ночь
    📷 Фото: 5 шт
    
    Всё верно?
    
    [✅ Опубликовать] [✏️ Редактировать] [❌ Отмена]
    ```

17. Риелтор нажимает "✅ Опубликовать"
18. Бот сохраняет объект (аналогично веб-версии)
19. Бот отправляет подтверждение:
    ```
    ✅ Объект опубликован!
    
    Ваша квартира добавлена и доступна
    для бронирования
    
    🔢 ID: #12345
    📍 Астана, Есильский район
    💰 5000 ₸/ночь
    
    [👀 Посмотреть] [➕ Добавить еще]
    [🏠 Мои квартиры] [🏢 Панель админа]
    ```

**Альтернативные потоки:**

**1a. Риелтор нажал "Назад":**
- Бот возвращается на предыдущий шаг
- Сохраняет введенные данные
- Позволяет изменить предыдущий ответ

**1b. Риелтор нажал "Отмена":**
```
Отменить добавление?

Все введенные данные будут потеряны

[Да, отменить] [Нет, продолжить]
```

**1c. Слишком короткое описание:**
```
❌ Описание слишком короткое

Минимум: 100 символов
Сейчас: 45 символов

Добавьте больше деталей:
• Чем хорошо жилье?
• Что есть в квартире?
• Что рядом?

Продолжайте описание:
```

**1d. Недостаточно фото:**
```
❌ Мало фотографий

Загружено: 2 фото
Минимум: 3 фото

Отправьте еще минимум 1 фото

[⬅️ Начать загрузку заново] [❌ Отмена]
```

**1e. Фото слишком большое:**
```
❌ Фото слишком большое

Размер: 12.5 МБ
Максимум: 7 МБ

Пожалуйста, сожмите фото или
выберите другое

Продолжайте отправку фото:
```

**Постусловия:** Объект создан и опубликован

---

### Сценарий 1.3: Просмотр своих объектов

**Предусловия:** 
- Риелтор авторизован
- Имеет хотя бы один объект

**Основной поток (веб):**

1. Риелтор переходит в "Панель риелтора" → "Мои объекты"
2. Система показывает список:
   ```
   Мои объекты (5)
   
   Фильтры: [Все ▼] [Активные: 4] [Неактивные: 1]
   Сортировка: [По дате добавления ▼]
   
   [➕ Добавить новый объект]
   
   ┌────────────────────────────────────────────────┐
   │ #12345 | 🟢 Активно                           │
   ├────────────────────────────────────────────────┤
   │ [📷 Фото]                                      │
   │                                                │
   │ 🏠 Уютная 2-комнатная в центре                │
   │ 📍 Есильский район, ул. Кабанбай батыра, 12   │
   │ 💰 5000 ₸/ночь                                 │
   │ ⭐ 4.8 (23 отзыва)                             │
   │                                                │
   │ 📊 Статистика (за месяц):                     │
   │    • Просмотров: 145                          │
   │    • Бронирований: 8                          │
   │    • Доход: 120 000 ₸                         │
   │    • Загрузка: 26%                            │
   │                                                │
   │ 📅 Ближайшие брони:                           │
   │    • 25-28 дек (3 ночи) - Марат К.           │
   │    • 01-05 янв (4 ночи) - Алия Н.            │
   │                                                │
   │ [✏️ Редактировать] [📊 Подробная статистика]  │
   │ [📅 Календарь] [⏸ Деактивировать]             │
   └────────────────────────────────────────────────┘
   
   ┌────────────────────────────────────────────────┐
   │ #12340 | 🔴 Неактивно                         │
   ├────────────────────────────────────────────────┤
   │ [📷 Фото]                                      │
   │                                                │
   │ 🏠 1-комнатная квартира                       │
   │ 📍 Алматинский район                          │
   │ 💰 4000 ₸/ночь                                 │
   │ ⭐ 4.5 (15 отзывов)                            │
   │                                                │
   │ ⚠️ Деактивирована: 15.10.2025                 │
   │ Причина: На ремонте                           │
   │                                                │
   │ [✏️ Редактировать] [▶️ Активировать]          │
   └────────────────────────────────────────────────┘
   ```

3. Риелтор может:
   - Просматривать статистику по каждому объекту
   - Редактировать объект
   - Деактивировать/активировать
   - Посмотреть календарь броней
   - Перейти к детальной статистике

**Основной поток (Telegram):**

1. Риелтор в панели администратора
2. Нажимает "🏠 Мои квартиры (5)"
3. Бот отправляет список:
   ```
   🏠 Мои квартиры (5)
   
   🟢 Активных: 4 | 🔴 Неактивных: 1
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   1️⃣ #12345 | 🟢 Активно
   
   Уютная 2-комнатная в центре
   📍 Есильский район
   💰 5000 ₸/ночь
   ⭐ 4.8 (23 отзыва)
   
   📊 За месяц:
   • Просмотры: 145
   • Брони: 8
   • Доход: 120 000 ₸
   
   [📋 Подробнее] [✏️ Редактировать]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   2️⃣ #12344 | 🟢 Активно
   ...
   
   Показано 1-2 из 5
   
   [Показать еще] [➕ Добавить новую]
   [🏢 Панель админа]
   ```

4. Риелтор нажимает "📋 Подробнее" на объект
5. Бот показывает детали:
   ```
   #12345 | Уютная 2-комнатная
   
   Статус: 🟢 Активно
   
   📍 Адрес:
   г. Астана, Есильский район
   ул. Кабанбай батыра, 12/2/7
   
   🏠 Характеристики:
   • Тип: Квартира (Бизнес)
   • Комнат: 2
   • Площадь: 65 м²
   • Спальных мест: 4
   
   💰 Цена: 5000 ₸/ночь
   ⭐ Рейтинг: 4.8 (23 отзыва)
   
   📅 Ближайшие брони:
   • 25-28 дек - Марат К. (15 750 ₸)
   • 01-05 янв - Алия Н. (20 000 ₸)
   
   📊 Статистика за 30 дней:
   • Просмотров: 145
   • Бронирований: 8
   • Доход: 120 000 ₸
   • Загрузка: 26% (8 из 30 дней)
   
   [✏️ Редактировать] [📅 Календарь]
   [📊 Полная статистика] [⏸ Деактивировать]
   [⬅️ К списку]
   ```

---

### Сценарий 1.4: Редактирование объекта

**Предусловия:**
- Риелтор владеет объектом
- Объект существует в системе

**Основной поток (веб):**

1. Риелтор в списке своих объектов
2. Нажимает "✏️ Редактировать" на объекте
3. Система открывает форму редактирования:
   ```
   Редактирование объекта #12345
   
   [Вкладка: Основное | Описание | Цены | Фото | Доступ]
   
   ┌──────────────────────────────────────┐
   │ Что можно изменять:                  │
   │ ✅ Название                          │
   │ ✅ Описание                          │
   │ ✅ Удобства                          │
   │ ✅ Цену                              │
   │ ✅ Правила заезда/выезда             │
   │ ✅ Фотографии (добавить/удалить)     │
   │ ✅ Инструкции доступа                │
   │                                      │
   │ ⛔ Нельзя изменить:                  │
   │ • Адрес (обратитесь в поддержку)    │
   │ • Тип жилья                          │
   │ • Количество комнат                  │
   └──────────────────────────────────────┘
   
   [Форма редактирования - аналогично добавлению]
   
   [Отмена] [💾 Сохранить изменения]
   ```

4. Риелтор вносит изменения
5. Нажимает "💾 Сохранить"
6. Система валидирует изменения
7. Сохраняет в БД:
   ```python
   with transaction.atomic():
       property = Property.objects.select_for_update().get(
           id=property_id,
           owner=realtor
       )
       
       # Обновляем поля
       property.name = new_name
       property.description = new_description
       property.price_per_night = new_price
       # ... остальные поля
       
       property.updated_at = now()
       property.save()
       
       # Логируем изменения
       log_action(
           user=realtor,
           action='PROPERTY_UPDATED',
           property_id=property.id,
           changes=changes_dict
       )
       
       # Уведомляем гостей с будущими бронями (если критичные изменения)
       if critical_changes:
           notify_guests_with_bookings.delay(property.id)
   ```

8. Показывает успех:
   ```
   ✅ Изменения сохранены
   
   Объект "Уютная 2-комнатная в центре"
   успешно обновлен
   
   [👀 Посмотреть на сайте] [📋 К моим объектам]
   ```

**Альтернативные потоки:**

**1a. Попытка изменить недопустимое поле:**
```
⚠️ Это поле нельзя изменить

Адрес объекта нельзя изменить после публикации.

Если вам действительно нужно изменить адрес,
свяжитесь с поддержкой.

[☎️ Связаться с поддержкой] [OK]
```

**1b. Есть активные брони (изменение критичных полей):**
```
⚠️ Есть активные бронирования

У объекта есть подтвержденные брони.
Изменение цены повлияет только на новые брони.

Текущие брони:
• 25-28 дек - по старой цене (5000 ₸)
• 01-05 янв - по старой цене (5000 ₸)

Продолжить?

[Да, сохранить] [Отмена]
```

---

### Сценарий 1.5: Деактивация/активация объекта

**Предусловия:**
- Риелтор владеет объектом
- Объект существует в системе

**Основной поток (деактивация веб):**

1. Риелтор в списке своих объектов или на странице редактирования
2. Нажимает "⏸ Деактивировать"
3. Система показывает диалог подтверждения:
   ```
   ⚠️ Деактивация объекта
   
   Объект "#12345 - Уютная 2-комнатная" будет
   снят с публикации.
   
   ⚠️ Важно:
   • Объект не будет отображаться в поиске
   • Новые бронирования будут невозможны
   • Существующие брони НЕ БУДУТ отменены
   
   Есть активные брони:
   • 25-28 дек - Марат К. (подтверждено)
   • 01-05 янв - Алия Н. (подтверждено)
   
   Укажите причину деактивации:
   
   ○ Ремонт
   ○ Личное использование
   ○ Сезонное закрытие
   ○ Продажа объекта
   ○ Другое: [________________]
   
   Планируемая дата активации (опционально):
   [__/__/____] 🗓
   
   [Отмена] [Деактивировать]
   ```

4. Риелтор выбирает причину
5. Может указать дату возврата
6. Нажимает "Деактивировать"
7. Система выполняет:
   ```python
   with transaction.atomic():
       property = Property.objects.select_for_update().get(
           id=property_id,
           owner=realtor
       )
       
       # Проверяем активные брони
       active_bookings = property.bookings.filter(
           status__in=['confirmed', 'paid'],
           check_out__gte=timezone.now()
       )
       
       # Деактивируем объект
       property.is_active = False
       property.deactivation_reason = reason
       property.deactivation_date = timezone.now()
       property.planned_reactivation_date = reactivation_date
       property.save()
       
       # Логируем
       log_action(
           user=realtor,
           action='PROPERTY_DEACTIVATED',
           property_id=property.id,
           reason=reason
       )
       
       # Блокируем все будущие даты в календаре
       Calendar.objects.filter(
           property=property,
           date__gt=timezone.now().date()
       ).update(
           blocked=True,
           block_reason='deactivated'
       )
   ```

8. Показывает подтверждение:
   ```
   ✅ Объект деактивирован
   
   "Уютная 2-комнатная в центре"
   снят с публикации
   
   Причина: Ремонт
   Активные брони: 2
   
   💡 Не забудьте:
   • Уведомить гостей с бронями
   • Активировать объект после завершения ремонта
   
   [📋 К моим объектам] [✉️ Написать гостям]
   ```

**Основной поток (активация веб):**

1. Риелтор в списке своих объектов
2. Нажимает "▶️ Активировать" на деактивированном объекте
3. Система показывает:
   ```
   Активация объекта
   
   Объект: Уютная 2-комнатная в центре
   
   Деактивирован: 15.10.2025
   Причина: Ремонт
   
   ✅ Объект готов к публикации?
   
   После активации:
   • Объект появится в поиске
   • Пользователи смогут его бронировать
   • Календарь будет разблокирован
   
   [Отмена] [Активировать]
   ```

4. Риелтор нажимает "Активировать"
5. Система выполняет:
   ```python
   with transaction.atomic():
       property = Property.objects.select_for_update().get(
           id=property_id,
           owner=realtor
       )
       
       property.is_active = True
       property.reactivation_date = timezone.now()
       property.save()
       
       # Разблокируем календарь
       Calendar.objects.filter(
           property=property,
           block_reason='deactivated'
       ).update(
           blocked=False,
           block_reason=None
       )
       
       log_action(
           user=realtor,
           action='PROPERTY_ACTIVATED',
           property_id=property.id
       )
   ```

6. Показывает успех:
   ```
   ✅ Объект активирован
   
   "Уютная 2-комнатная в центре"
   снова доступен для бронирования
   
   [👀 Посмотреть на сайте] [📋 К объектам]
   ```

**Основной поток (Telegram):**

1. Риелтор в списке объектов
2. Выбирает объект → "⏸ Деактивировать"
3. Бот отправляет:
   ```
   ⚠️ Деактивация объекта
   
   #12345 | Уютная 2-комнатная
   
   Объект будет снят с публикации.
   Активные брони НЕ отменяются.
   
   Текущие брони: 2
   • 25-28 дек - Марат К.
   • 01-05 янв - Алия Н.
   
   Укажите причину:
   
   [🔧 Ремонт] [🏠 Личное использование]
   [❄️ Сезонное] [💼 Продажа]
   [✏️ Другое]
   
   [❌ Отмена]
   ```

4. Риелтор выбирает причину
5. Если "Другое" - бот запрашивает текст
6. Бот подтверждает:
   ```
   ✅ Объект деактивирован
   
   Уютная 2-комнатная в центре
   снят с публикации
   
   Причина: Ремонт
   
   Для активации используйте
   кнопку "▶️ Активировать"
   
   [🏢 Панель админа]
   ```

**Альтернативные потоки:**

**1a. Попытка деактивировать уже неактивный:**
```
⚠️ Объект уже деактивирован

Этот объект не опубликован с 15.10.2025
Причина: Ремонт

[▶️ Активировать] [OK]
```

**1b. Есть неоплаченные брони:**
```
⚠️ Есть неоплаченные бронирования

У объекта есть брони ожидающие оплаты:
• 10-12 ноя - Асель Т. (ожидает оплаты)

Что делать с этими бронями?

○ Отменить их автоматически
○ Оставить время на оплату (24ч)

[Отмена] [Продолжить]
```

---

### Сценарий 1.6: Удаление объекта

**Предусловия:**
- Риелтор владеет объектом
- Объект существует в системе

**Основной поток (веб):**

1. Риелтор на странице редактирования объекта
2. Нажимает кнопку "🗑 Удалить объект" (красная, внизу страницы)
3. Система проверяет наличие активных броней
4. Показывает диалог с предупреждением:
   ```
   ⚠️ УДАЛЕНИЕ ОБЪЕКТА
   
   Вы уверены, что хотите удалить объект?
   
   #12345 | Уютная 2-комнатная в центре
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ ЭТО ДЕЙСТВИЕ НЕЛЬЗЯ ОТМЕНИТЬ
   
   Будет удалено:
   • Информация об объекте
   • 6 фотографий
   • 23 отзыва (архивируются)
   • История бронирований (архивируется)
   
   НЕ БУДЕТ удалено:
   • Ваши финансовые данные (для отчетности)
   • Данные завершенных броней
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Статус объекта:
   ✅ Нет активных бронирований
   ✅ Нет будущих броней
   
   Для подтверждения введите название объекта:
   [_____________________________________]
   
   [Отмена] [🗑 Удалить навсегда]
   ```

5. Риелтор вводит название объекта для подтверждения
6. Нажимает "Удалить навсегда"
7. Система выполняет:
   ```python
   with transaction.atomic():
       property = Property.objects.select_for_update().get(
           id=property_id,
           owner=realtor
       )
       
       # Проверяем активные брони
       active_bookings = property.bookings.filter(
           status__in=['confirmed', 'paid'],
           check_out__gte=timezone.now()
       )
       
       if active_bookings.exists():
           raise ValidationError("Невозможно удалить с активными бронями")
       
       # Архивируем отзывы
       property.reviews.all().update(
           archived=True,
           archived_date=timezone.now()
       )
       
       # Soft delete (помечаем как удаленный)
       property.deleted = True
       property.deleted_at = timezone.now()
       property.is_active = False
       property.save()
       
       # Удаляем фото из Minio
       for photo in property.photos.all():
           delete_from_minio(photo.url)
       
       # Логируем
       log_action(
           user=realtor,
           action='PROPERTY_DELETED',
           property_id=property.id,
           details={'name': property.name}
       )
   ```

8. Показывает подтверждение:
   ```
   ✅ Объект удален
   
   "Уютная 2-комнатная в центре" удален
   из системы
   
   Данные о завершенных бронированиях
   сохранены для отчетности
   
   [📋 К моим объектам]
   ```

**Альтернативные потоки:**

**1a. Есть активные или будущие брони:**
```
❌ Невозможно удалить объект

У объекта есть активные или предстоящие
бронирования:

Будущие брони (2):
• 25-28 дек - Марат К. (оплачено)
• 01-05 янв - Алия Н. (оплачено)

Вы можете:
1. Деактивировать объект (временно)
2. Дождаться завершения всех броней
3. Связаться с поддержкой для принудительного удаления

[⏸ Деактивировать] [☎️ Связаться с поддержкой] [Отмена]
```

**1b. Название не совпадает:**
```
❌ Название не совпадает

Для подтверждения введите точное название:
"Уютная 2-комнатная в центре"

[Попробовать снова] [Отмена]
```

**1c. Объект с высоким рейтингом:**
```
💡 Подумайте дважды

Этот объект имеет отличный рейтинг:
⭐ 4.8 из 5 (23 отзыва)

Доход за последний месяц: 120 000 ₸

Вы уверены, что хотите его удалить?
Возможно, лучше деактивировать временно?

[⏸ Деактивировать вместо удаления]
[🗑 Все равно удалить]
[Отмена]
```

**Основной поток (Telegram):**

1. Риелтор в деталях объекта
2. Нажимает "🗑 Удалить объект"
3. Бот отправляет:
   ```
   ⚠️ УДАЛЕНИЕ ОБЪЕКТА
   
   #12345 | Уютная 2-комнатная
   
   ━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ Действие необратимо!
   
   Будет удалено:
   • Информация и фото
   • 23 отзыва (в архив)
   • История броней (в архив)
   
   Статус:
   ✅ Нет активных броней
   
   Для подтверждения отправьте:
   DELETE 12345
   
   [❌ Отмена]
   ```

4. Риелтор отправляет "DELETE 12345"
5. Бот удаляет объект
6. Отправляет подтверждение:
   ```
   ✅ Объект удален
   
   Уютная 2-комнатная в центре
   удален из системы
   
   [🏠 Мои квартиры] [🏢 Панель админа]
   ```

---

## 2. Управление бронированиями

### Сценарий 2.1: Просмотр бронирований своих объектов

**Предусловия:**
- Риелтор авторизован
- Имеет объекты с бронированиями

**Основной поток (веб):**

1. Риелтор переходит "Панель риелтора" → "Мои бронирования"
2. Система показывает список с вкладками:
   ```
   Мои бронирования
   
   [Текущие (3)] [Будущие (5)] [История (45)] [Все]
   
   Фильтры:
   Объект: [Все мои объекты ▼]
   Статус: [Все ▼]
   Период: [__/__/____] - [__/__/____] 🗓
   
   [Применить фильтры] [Сбросить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ТЕКУЩИЕ БРОНИРОВАНИЯ (3)
   
   ┌─────────────────────────────────────────────┐
   │ Бронь #BR-12345 | 🟢 Активна (гость заселен)│
   ├─────────────────────────────────────────────┤
   │ 🏠 Уютная 2-комнатная в центре             │
   │ 📅 23.12.2025 (14:00) → 28.12.2025 (12:00) │
   │ 🛏 5 ночей                                  │
   │                                             │
   │ 👤 Гость: Марат Каримов                    │
   │ 📱 +7 777 123 4567                         │
   │ 💰 Оплачено: 25 000 ₸ (Kaspi)             │
   │                                             │
   │ Заселение: 23.12.2025 в 14:30 ✅           │
   │ Выезд через: 2 дня 5 часов                 │
   │                                             │
   │ [💬 Написать гостю] [📋 Детали брони]      │
   │ [📍 Показать инструкции]                   │
   └─────────────────────────────────────────────┘
   ```

3. Риелтор может переключаться между вкладками, фильтровать

**Детали брони:**

4. Риелтор нажимает "📋 Детали брони"
5. Система показывает полную информацию (аналогично пользовательским сценариям, но с дополнительными опциями для риелтора)

**Основной поток (Telegram):**

1. Риелтор в панели админа → "📋 Мои бронирования"
2. Бот показывает список с фильтрами
3. Риелтор может просматривать детали каждой брони

**Постусловия:** 
- Риелтор имеет полный обзор всех бронирований
- Может связаться с гостями
- Может отменить или изменить статус брони

---

Продолжение в следующем сообщении с остальными сценариями (2.2-6.2)...

### Сценарий 2.2: Подтверждение оплаты вручную (до интеграции Kaspi)

**Предусловия:**
- Риелтор имеет бронь со статусом "Ожидает оплаты"
- Оплата производится вне системы (перевод, наличные)

**Основной поток (веб):**

1. Риелтор в списке бронирований
2. Видит бронь со статусом "🟡 Ожидает оплаты"
3. Нажимает "Подтвердить оплату"
4. Система показывает форму подтверждения с полями:
   - Способ оплаты (перевод/Kaspi/наличные/другое)
   - Дата и время получения
   - Сумма
   - Загрузка чека (опционально)
   - Комментарий

5. Риелтор заполняет и отправляет
6. Система обновляет статус брони на "Подтверждена"
7. Гость получает уведомление с инструкциями по заселению
8. В инструкциях содержатся коды доступа (расшифрованные)

**Основной поток (Telegram):**

1. Риелтор выбирает бронь → "✅ Подтвердить оплату"
2. Бот пошагово запрашивает:
   - Способ оплаты (кнопки)
   - Сумму (текст)
   - Опционально чек (фото)
3. Подтверждает и уведомляет гостя

**Альтернативные потоки:**
- Сумма не совпадает → предупреждение и варианты действий
- Оплата уже подтверждена → ошибка
- Бронь отменена → нельзя подтвердить

---

### Сценарий 2.3: Отмена бронирования риелтором

**Предусловия:**
- Риелтор владеет объектом с бронью
- Бронь активна или запланирована

**Основной поток (веб):**

1. Риелтор в деталях брони
2. Нажимает "❌ Отменить бронь"
3. Система показывает форму:
   ```
   ⚠️ Отмена бронирования
   
   Бронь #BR-12345
   👤 Марат Каримов
   📅 25-28 дек (5 ночей)
   💰 25 000 ₸ (оплачено)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Укажите причину отмены *
   
   ○ Проблема с объектом (поломка, затопление)
   ○ По просьбе гостя
   ○ Двойное бронирование (ошибка)
   ○ Нарушение правил гостем
   ○ Форс-мажор
   ○ Другое: [________________]
   
   Комментарий для гостя (опционально)
   [_________________________________]
   [_________________________________]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Возврат средств:
   
   ☑ Вернуть полную сумму (25 000 ₸)
   
   💡 Отмена по инициативе риелтора
      обычно предполагает полный возврат
   
   [Отменить действие] [Подтвердить отмену]
   ```

4. Риелтор заполняет причину и комментарий
5. Нажимает "Подтвердить отмену"
6. Система выполняет:
   ```python
   with transaction.atomic():
       booking = Booking.objects.select_for_update().get(
           id=booking_id,
           property__owner=realtor
       )
       
       # Проверяем возможность отмены
       if booking.check_in <= timezone.now():
           raise ValidationError("Нельзя отменить после заселения")
       
       # Отменяем бронь
       booking.status = 'cancelled_by_host'
       booking.cancellation_reason = reason
       booking.cancellation_comment = comment
       booking.cancelled_at = timezone.now()
       booking.cancelled_by = realtor
       booking.save()
       
       # Освобождаем даты в календаре
       Calendar.objects.filter(
           property=booking.property,
           date__range=(booking.check_in, booking.check_out),
           booking=booking
       ).update(
           blocked=False,
           booking=None
       )
       
       # Инициируем возврат если была оплата
       if booking.payment:
           refund = create_refund(
               payment=booking.payment,
               amount=booking.total_amount,
               reason=reason
           )
       
       # Логируем
       log_action(
           user=realtor,
           action='BOOKING_CANCELLED_BY_HOST',
           booking_id=booking.id,
           reason=reason
       )
       
       # Уведомляем гостя
       notify_guest_booking_cancelled.delay(
           booking.id,
           cancelled_by='host'
       )
   ```

7. Показывает подтверждение:
   ```
   ✅ Бронирование отменено
   
   Бронь #BR-12345 отменена
   
   • Даты освобождены в календаре
   • Гость получил уведомление
   • Возврат 25 000 ₸ инициирован
     (поступит в течение 3-5 рабочих дней)
   
   [📋 К бронированиям] [📅 Календарь]
   ```

8. Гость получает уведомление:
   ```
   ❌ Ваше бронирование отменено
   
   Бронь #BR-12345
   Уютная 2-комнатная в центре
   25-28 дек 2025
   
   Причина: Проблема с объектом
   
   Комментарий риелтора:
   "К сожалению, произошла авария с
   отоплением. Приносим извинения."
   
   💰 Возврат средств:
   Сумма: 25 000 ₸
   Вернется на вашу карту в течение 3-5 дней
   
   Мы предлагаем скидку 15% на следующее
   бронирование в качестве компенсации
   
   [Найти другое жилье] [Связаться с поддержкой]
   ```

**Основной поток (Telegram):**

1. Риелтор выбирает бронь → "❌ Отменить"
2. Бот запрашивает причину (кнопки)
3. Запрашивает комментарий для гостя
4. Подтверждает возврат средств
5. Отменяет и уведомляет гостя

**Альтернативные потоки:**

**1a. Попытка отмены после заселения:**
```
❌ Невозможно отменить

Гость уже заселился (23.12.2025 14:30)

Для разрешения споров с активными
гостями обратитесь в поддержку

[☎️ Связаться с поддержкой] [OK]
```

**1b. Бронь уже отменена:**
```
⚠️ Бронь уже отменена

Эта бронь отменена: 20.12.2025
Отменил: Гость
Причина: Изменились планы

[OK]
```

---

### Сценарий 2.4: Общение с гостем

**Предусловия:**
- Риелтор имеет активную или будущую бронь
- Гость забронировал объект риелтора

**Основной поток (веб):**

1. Риелтор в деталях брони
2. Нажимает "💬 Написать гостю"
3. Система показывает интерфейс чата:
   ```
   Чат с гостем
   
   Бронь #BR-12345
   👤 Марат Каримов
   📅 25-28 дек, 5 ночей
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [История переписки]
   
   20.12.2025 19:00 (Гость):
   Добрый день! Подскажите, есть ли
   детская кроватка?
   
   20.12.2025 19:15 (Вы):
   Здравствуйте! Да, детская кроватка
   есть. Установим перед вашим приездом.
   
   23.12.2025 10:00 (Гость):
   Спасибо! Приедем около 14:30
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Написать сообщение:
   
   [________________________________]
   [________________________________]
   [________________________________]
   
   [📎 Прикрепить файл]
   
   [Отправить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Быстрые ответы:
   • Инструкции по заселению
   • Правила проживания
   • Контакты для связи
   ```

4. Риелтор пишет сообщение
5. Нажимает "Отправить"
6. Система сохраняет в БД:
   ```python
   message = Message.objects.create(
       booking=booking,
       sender=realtor,
       recipient=guest,
       text=message_text,
       sent_at=timezone.now()
   )
   
   # Уведомляем гостя
   notify_new_message.delay(message.id)
   ```

7. Гость получает уведомление (email/Telegram)
8. Сообщение появляется в чате у обоих

**Основной поток (Telegram):**

1. Риелтор в деталях брони → "💬 Написать"
2. Открывается чат с гостем
3. Риелтор пишет сообщение
4. Отправляет
5. Гость получает в Telegram (если привязан) или на email
6. Может ответить прямо в боте

**Особенности:**

- Чат доступен только для подтвержденных броней
- История сохраняется
- Можно прикреплять фото (инструкции, фото объекта)
- Шаблоны быстрых ответов для частых вопросов
- Уведомления о новых сообщениях

**Альтернативные потоки:**

**1a. Бронь завершена давно:**
```
⚠️ Старая бронь

Эта бронь завершилась 6 месяцев назад.
Чат закрыт.

Для связи с бывшим гостем используйте
другие каналы коммуникации.

[OK]
```

**1b. Гость не отвечает:**
```
💡 Совет

Гость не читал ваши сообщения
более 2 дней.

Рекомендуем позвонить:
📞 +7 777 123 4567

[Позвонить] [OK]
```

---

## 3. Календарь и управление доступностью

### Сценарий 3.1: Просмотр календаря занятости

**Предусловия:**
- Риелтор владеет объектами
- Объекты имеют брони

**Основной поток (веб):**

1. Риелтор переходит "Мои объекты" → выбирает объект → "📅 Календарь"
2. Система показывает календарь:
   ```
   Календарь занятости
   
   Объект: Уютная 2-комнатная в центре
   
   [◀ Октябрь 2025] [Ноябрь 2025] [Декабрь 2025 ▶]
   
   ┌─────────────────────────────────────────────┐
   │             ДЕКАБРЬ 2025                    │
   ├───┬───┬───┬───┬───┬───┬───────────────────┤
   │ Пн│ Вт│ Ср│ Чт│ Пт│ Сб│ Вс                │
   ├───┼───┼───┼───┼───┼───┼────────────────── │
   │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7                 │
   │ 🟢│ 🟢│🔵🔵│🔵🔵│🔵🔵│🔵🔵│ 🟢                │
   ├───┼───┼───┼───┼───┼───┼────────────────── │
   │ 8 │ 9 │10 │11 │12 │13 │14                 │
   │ 🟢│ 🟢│ 🟢│ 🟢│🟡🟡│🟡🟡│🟡🟡                │
   ├───┼───┼───┼───┼───┼───┼────────────────── │
   │15 │16 │17 │18 │19 │20 │21                 │
   │ 🟢│ 🟢│ 🟢│ 🟢│ 🟢│ 🟢│ 🟢                │
   ├───┼───┼───┼───┼───┼───┼────────────────── │
   │22 │23 │24 │25 │26 │27 │28                 │
   │ 🟢│🟢🔴│🔴🔴│🔴🔴│🔴🔴│🔴🟢│ 🟢                │
   ├───┼───┼───┼───┼───┼───┼────────────────── │
   │29 │30 │31 │   │   │   │                   │
   │ 🟢│ 🟢│ 🟢│   │   │   │                   │
   └───┴───┴───┴───┴───┴───┴────────────────── ┘
   
   Легенда:
   🟢 Свободно
   🔵 Забронировано (подтверждено)
   🔴 Занято (гость проживает)
   🟡 Ожидает оплаты
   ⚫ Заблокировано вручную
   
   [Выбрать даты для блокировки]
   ```

3. Риелтор может:
   - Кликнуть на дату для деталей
   - Выбрать диапазон дат для блокировки
   - Переключаться между месяцами
   - Видеть статистику загрузки

**При клике на дату с бронью:**

4. Показывается детальная информация:
   ```
   25-28 декабря 2025
   
   Бронь #BR-12345
   👤 Марат Каримов
   🛏 5 ночей
   💰 25 000 ₸
   
   Статус: 🔴 Гость проживает
   Заселен: 25.12 в 14:30
   Выезд: 28.12 в 12:00
   
   [Открыть бронь] [Написать гостю] [Закрыть]
   ```

**Основной поток (Telegram):**

1. Риелтор выбирает объект → "📅 Календарь"
2. Бот показывает текстовый календарь:
   ```
   📅 Календарь: Декабрь 2025
   
   Уютная 2-комнатная в центре
   
   1-7 дек:   🟢🟢🔵🔵🟢🟢🟢
   8-14 дек:  🟢🟢🟢🟡🟡🟡🟢
   15-21 дек: 🟢🟢🟢🟢🟢🟢🟢
   22-28 дек: 🟢🔴🔴🔴🔴🟢🟢
   29-31 дек: 🟢🟢🟢
   
   🟢 Свободно
   🔵 Забронировано
   🔴 Занято
   🟡 Ожидает оплаты
   
   Загрузка: 40% (12 из 30 дней)
   
   [◀ Предыдущий месяц] [Следующий ▶]
   [🔒 Заблокировать даты] [⬅️ К объекту]
   ```

3. Риелтор может листать месяцы
4. Может перейти к блокировке дат

**Постусловия:**
- Риелтор видит полную картину занятости
- Может планировать обслуживание
- Может блокировать даты

---

### Сценарий 3.2: Блокировка дат вручную

**Предусловия:**
- Риелтор владеет объектом
- Хочет временно сделать даты недоступными

**Основной поток (веб):**

1. Риелтор в календаре объекта
2. Нажимает "Выбрать даты для блокировки"
3. Выделяет диапазон дат мышкой
4. Система показывает форму:
   ```
   Блокировка дат
   
   Объект: Уютная 2-комнатная в центре
   Даты: 10-15 января 2026 (6 ночей)
   
   ┌─────────────────────────────────────────────┐
   │ Причина блокировки *                        │
   ├─────────────────────────────────────────────┤
   │ ○ Личное использование                      │
   │ ○ Ремонт / обслуживание                     │
   │ ○ Уборка / подготовка                       │
   │ ○ Забронировано вне системы                 │
   │ ○ Другое: [____________________]            │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Комментарий (опционально)                   │
   ├─────────────────────────────────────────────┤
   │ [_______________________________________]   │
   │ [_______________________________________]   │
   └─────────────────────────────────────────────┘
   
   ⚠️ На эти даты будут недоступны для бронирования
   
   [Отмена] [Заблокировать]
   ```

5. Риелтор выбирает причину
6. Нажимает "Заблокировать"
7. Система выполняет:
   ```python
   with transaction.atomic():
       property = Property.objects.select_for_update().get(
           id=property_id,
           owner=realtor
       )
       
       # Проверяем нет ли уже броней на эти даты
       overlapping_bookings = Booking.objects.filter(
           property=property,
           status__in=['confirmed', 'paid'],
           check_in__lt=end_date,
           check_out__gt=start_date
       )
       
       if overlapping_bookings.exists():
           raise ValidationError("На эти даты уже есть бронирования")
       
       # Блокируем даты
       dates_to_block = []
       current_date = start_date
       while current_date <= end_date:
           dates_to_block.append(
               Calendar(
                   property=property,
                   date=current_date,
                   blocked=True,
                   block_reason=reason,
                   block_comment=comment,
                   blocked_by=realtor,
                   blocked_at=timezone.now()
               )
           )
           current_date += timedelta(days=1)
       
       Calendar.objects.bulk_create(
           dates_to_block,
           update_conflicts=True,
           update_fields=['blocked', 'block_reason', 'block_comment']
       )
       
       log_action(
           user=realtor,
           action='DATES_BLOCKED',
           property_id=property.id,
           details={'dates': f'{start_date} - {end_date}'}
       )
   ```

8. Показывает подтверждение:
   ```
   ✅ Даты заблокированы
   
   10-15 января 2026 (6 ночей)
   заблокированы
   
   Причина: Ремонт / обслуживание
   
   Эти даты не будут доступны для
   бронирования гостями
   
   [📅 К календарю] [OK]
   ```

9. В календаре даты отображаются как ⚫ (заблокировано)

**Основной поток (Telegram):**

1. Риелтор в календаре → "🔒 Заблокировать даты"
2. Бот запрашивает:
   ```
   Блокировка дат
   
   Уютная 2-комнатная в центре
   
   Шаг 1: Дата начала
   
   Введите дату начала блокировки:
   Формат: ДД.ММ.ГГГГ
   
   [❌ Отмена]
   ```

3. Риелтор вводит дату начала (например: 10.01.2026)
4. Бот запрашивает дату окончания
5. Риелтор вводит дату окончания (например: 15.01.2026)
6. Бот показывает причины:
   ```
   Выберите причину блокировки:
   
   Даты: 10-15 янв 2026 (6 ночей)
   
   [🏠 Личное использование]
   [🔧 Ремонт]
   [🧹 Уборка]
   [📅 Бронь вне системы]
   [✏️ Другое]
   
   [❌ Отмена]
   ```

7. Риелтор выбирает причину
8. Бот блокирует и подтверждает:
   ```
   ✅ Даты заблокированы
   
   10-15 янв 2026 (6 ночей)
   Причина: Ремонт
   
   [📅 Календарь] [⬅️ К объекту]
   ```

**Альтернативные потоки:**

**1a. Даты уже забронированы:**
```
❌ Невозможно заблокировать

На выбранные даты уже есть
подтвержденные бронирования:

• 12-14 янв - Айгуль С. (#BR-12350)

Освободите эти даты или выберите
другой период

[Выбрать другие даты] [Отмена]
```

**1b. Блокировка в прошлом:**
```
❌ Неверная дата

Нельзя заблокировать прошедшие даты

Выберите даты начиная с сегодня
или позднее

[Попробовать снова] [Отмена]
```

---

### Сценарий 3.3: Массовая блокировка периода

**Предусловия:**
- Риелтор хочет заблокировать длительный период
- Например, на время отпуска или ремонта

**Основной поток (веб):**

1. Риелтор в календаре объекта
2. Нажимает "Массовая блокировка"
3. Система показывает форму:
   ```
   Массовая блокировка дат
   
   Объект: Уютная 2-комнатная в центре
   
   ┌─────────────────────────────────────────────┐
   │ Период блокировки *                         │
   ├─────────────────────────────────────────────┤
   │ С: [__/__/____] 🗓                          │
   │ По: [__/__/____] 🗓                         │
   │                                             │
   │ Всего дней: будет рассчитано                │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Причина *                                   │
   ├─────────────────────────────────────────────┤
   │ [Выберите причину ▼]                        │
   │                                             │
   │ Дополнительно:                              │
   │ [_______________________________________]   │
   └─────────────────────────────────────────────┘
   
   ⚠️ Важно:
   • Существующие брони НЕ отменятся
   • Будут заблокированы только свободные даты
   • Можно разблокировать позже
   
   [Отмена] [Предпросмотр] [Заблокировать]
   ```

4. Риелтор выбирает период (например, 01.02.2026 - 28.02.2026)
5. Выбирает причину
6. Нажимает "Предпросмотр"
7. Система показывает превью:
   ```
   Предпросмотр блокировки
   
   Период: 01-28 февраля 2026 (28 дней)
   Причина: Личное использование
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Статус дат:
   
   ✅ Будет заблокировано: 22 дня
   ⚠️ Уже забронировано: 6 дней
   
   Существующие брони:
   • 05-08 фев - Дамир Т. (#BR-12351)
   • 15-17 фев - Алмас К. (#BR-12352)
   
   Эти брони НЕ отменятся.
   Будут заблокированы только свободные даты.
   
   Продолжить?
   
   [Отмена] [✅ Подтвердить блокировку]
   ```

8. Риелтор подтверждает
9. Система блокирует свободные даты
10. Показывает результат:
    ```
    ✅ Блокировка выполнена
    
    Февраль 2026:
    • Заблокировано: 22 дня
    • Пропущено (есть брони): 6 дней
    
    Объект недоступен для новых
    бронирований на эти даты
    
    [📅 Календарь] [OK]
    ```

**Основной поток (Telegram):**

Аналогично веб-версии, но упрощенный интерфейс с пошаговыми вопросами

**Альтернативные потоки:**

**1a. Весь период занят бронями:**
```
⚠️ Период полностью занят

На все выбранные даты уже есть
подтвержденные бронирования

Невозможно заблокировать ни один день

[Выбрать другой период] [Отмена]
```

---

Продолжить со сценариями работы с отзывами, аналитикой и уведомлениями?

## 4. Работа с отзывами

### Сценарий 4.1: Просмотр отзывов о своих объектах

**Предусловия:**
- Риелтор владеет объектами
- Гости оставили отзывы после проживания

**Основной поток (веб):**

1. Риелтор переходит "Панель риелтора" → "Отзывы"
2. Система показывает список отзывов:
   ```
   Отзывы о моих объектах (23)
   
   Фильтры:
   Объект: [Все мои объекты ▼]
   Рейтинг: [Все ▼] (5★ / 4★ / 3★ / 2★ / 1★)
   Период: [За все время ▼]
   
   Сортировка: [Сначала новые ▼]
   
   [Применить] [Сбросить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ┌─────────────────────────────────────────────┐
   │ ⭐⭐⭐⭐⭐ 5.0                               │
   ├─────────────────────────────────────────────┤
   │ 👤 Марат Каримов                           │
   │ 🏠 Уютная 2-комнатная в центре             │
   │ 📅 Проживал: 23-28 декабря 2025            │
   │ 📝 Опубликован: 29 декабря 2025            │
   │                                             │
   │ "Отличная квартира! Все как на фото,        │
   │  чисто, уютно. Удобное расположение,        │
   │  рядом магазины и метро. Риелтор очень      │
   │  отзывчивый, быстро отвечал на вопросы.     │
   │  Обязательно вернемся!"                     │
   │                                             │
   │ [📷 2 фото]                                 │
   │                                             │
   │ ✅ Ваш ответ (30.12.2025):                 │
   │ "Спасибо за теплый отзыв, Марат!            │
   │  Будем рады видеть вас снова!"              │
   │                                             │
   │ [Редактировать ответ]                       │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ ⭐⭐⭐⭐☆ 4.0                               │
   ├─────────────────────────────────────────────┤
   │ 👤 Алия Нурланова                          │
   │ 🏠 1-комнатная квартира                    │
   │ 📅 Проживала: 15-18 января 2026            │
   │ 📝 Опубликован: 19 января 2026             │
   │                                             │
   │ "В целом хорошо, но был небольшой шум       │
   │  от соседей. Квартира чистая, все           │
   │  необходимое есть."                         │
   │                                             │
   │ ❌ Ответ не добавлен                       │
   │ [💬 Ответить на отзыв]                     │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ ⭐⭐☆☆☆ 2.0                                │
   ├─────────────────────────────────────────────┤
   │ 👤 Асель Токтарова                         │
   │ 🏠 2-комнатная на окраине                  │
   │ 📅 Проживала: 10-12 декабря 2025           │
   │ 📝 Опубликован: 13 декабря 2025            │
   │                                             │
   │ "К сожалению, не оправдало ожидания.        │
   │  Отопление работало плохо, было холодно.    │
   │  Также не было горячей воды во второй       │
   │  день."                                     │
   │                                             │
   │ ⚠️ Ответ не добавлен (прошло 17 дней)     │
   │ [💬 Ответить СРОЧНО]                       │
   └─────────────────────────────────────────────┘
   ```

3. Риелтор может:
   - Фильтровать отзывы
   - Читать полные тексты
   - Отвечать на отзывы
   - Просматривать фото гостей

**Статистика отзывов:**

4. В верхней части страницы показывается сводка:
   ```
   📊 Статистика отзывов
   
   Средний рейтинг: ⭐ 4.6 из 5
   Всего отзывов: 23
   
   Распределение:
   5★ ███████████████░░░░ 15 (65%)
   4★ ██████░░░░░░░░░░░░░  5 (22%)
   3★ ██░░░░░░░░░░░░░░░░░  2 (9%)
   2★ █░░░░░░░░░░░░░░░░░░  1 (4%)
   1★ ░░░░░░░░░░░░░░░░░░░  0 (0%)
   
   ⚠️ Без ответа: 3 отзыва
   ```

**Основной поток (Telegram):**

1. Риелтор в панели админа → "⭐ Отзывы"
2. Бот показывает список:
   ```
   ⭐ Отзывы (23)
   
   Средний рейтинг: 4.6/5
   Без ответа: 3
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   1️⃣ ⭐⭐⭐⭐⭐ 5.0
   
   👤 Марат Каримов
   🏠 Уютная 2-комнатная
   📅 23-28 дек 2025
   
   "Отличная квартира! Все как на..."
   
   ✅ Вы ответили
   
   [Читать полностью]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   2️⃣ ⭐⭐⭐⭐☆ 4.0
   
   👤 Алия Нурланова
   🏠 1-комнатная квартира
   📅 15-18 янв 2026
   
   "В целом хорошо, но был небольшой..."
   
   ❌ Нет ответа
   
   [Читать] [Ответить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [Показать еще] [Фильтры]
   [🏢 Панель админа]
   ```

3. При выборе отзыва показывает полный текст и опции

**Альтернативные потоки:**

**1a. Нет отзывов:**
```
⭐ Отзывы

У вас пока нет отзывов

Отзывы появятся после того, как
гости завершат проживание и оценят
ваши объекты

💡 Как получить больше отзывов:
• Просите гостей оставить отзыв
• Обеспечьте отличный сервис
• Быстро реагируйте на проблемы

[🏢 Панель админа]
```

---

### Сценарий 4.2: Ответ на отзыв

**Предусловия:**
- Риелтор получил отзыв от гостя
- Отзыв еще не имеет ответа (или нужно отредактировать)

**Основной поток (веб):**

1. Риелтор в списке отзывов
2. Нажимает "💬 Ответить на отзыв" под отзывом
3. Система показывает форму:
   ```
   Ответ на отзыв
   
   Отзыв от Алии Нурлановой
   ⭐⭐⭐⭐☆ 4.0
   
   ┌─────────────────────────────────────────────┐
   │ Отзыв гостя:                                │
   ├─────────────────────────────────────────────┤
   │ "В целом хорошо, но был небольшой шум       │
   │  от соседей. Квартира чистая, все           │
   │  необходимое есть."                         │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Ваш ответ                                   │
   ├─────────────────────────────────────────────┤
   │ [_______________________________________]   │
   │ [_______________________________________]   │
   │ [_______________________________________]   │
   │ [_______________________________________]   │
   │                                             │
   │ Введено: 0 / 500 символов                   │
   └─────────────────────────────────────────────┘
   
   💡 Советы для ответа:
   • Поблагодарите за отзыв
   • Ответьте на замечания конструктивно
   • Укажите, что планируете исправить
   • Будьте вежливы, даже при критике
   
   ┌─────────────────────────────────────────────┐
   │ Шаблоны ответов                             │
   ├─────────────────────────────────────────────┤
   │ [На положительный отзыв]                    │
   │ [На нейтральный отзыв]                      │
   │ [На отрицательный отзыв]                    │
   └─────────────────────────────────────────────┘
   
   [Отмена] [Опубликовать ответ]
   ```

4. Риелтор пишет ответ (или выбирает шаблон и дорабатывает)
5. Нажимает "Опубликовать ответ"
6. Система валидирует:
   - Минимум 10 символов
   - Максимум 500 символов
   - Отсутствие мата и оскорблений
7. Сохраняет в БД:
   ```python
   with transaction.atomic():
       review = Review.objects.select_for_update().get(
           id=review_id,
           property__owner=realtor
       )
       
       if review.host_response:
           # Редактирование существующего ответа
           review.host_response = response_text
           review.host_response_updated_at = timezone.now()
       else:
           # Новый ответ
           review.host_response = response_text
           review.host_responded_at = timezone.now()
       
       review.save()
       
       log_action(
           user=realtor,
           action='REVIEW_RESPONSE_ADDED',
           review_id=review.id
       )
       
       # Уведомляем гостя
       notify_guest_review_response.delay(review.id)
   ```

8. Показывает подтверждение:
   ```
   ✅ Ответ опубликован
   
   Ваш ответ на отзыв Алии Нурлановой
   опубликован
   
   Гость получит уведомление о вашем ответе
   
   [Посмотреть отзыв] [К списку отзывов]
   ```

9. Гость получает уведомление:
   ```
   Риелтор ответил на ваш отзыв
   
   Отзыв о: 1-комнатная квартира
   
   Ответ риелтора:
   "Спасибо за ваш отзыв, Алия! Рады,
   что вам понравилась квартира. По поводу
   шума от соседей - это, к сожалению,
   особенность дома. Мы добавили в описание
   информацию о звукоизоляции. Будем рады
   видеть вас снова!"
   
   [Посмотреть отзыв]
   ```

**Основной поток (Telegram):**

1. Риелтор выбирает отзыв без ответа
2. Нажимает "💬 Ответить"
3. Бот показывает отзыв и запрашивает:
   ```
   Ответ на отзыв
   
   ⭐⭐⭐⭐☆ 4.0 от Алии Нурлановой
   
   "В целом хорошо, но был небольшой
   шум от соседей. Квартира чистая,
   все необходимое есть."
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Напишите ваш ответ:
   (от 10 до 500 символов)
   
   Или выберите шаблон:
   
   [📝 Шаблон для хорошего отзыва]
   [📝 Шаблон для среднего отзыва]
   
   [❌ Отмена]
   ```

4. Риелтор пишет ответ или выбирает шаблон
5. Бот публикует и подтверждает:
   ```
   ✅ Ответ опубликован
   
   Ваш ответ добавлен к отзыву
   Алия получит уведомление
   
   [⭐ К отзывам] [🏢 Панель]
   ```

**Альтернативные потоки:**

**1a. Ответ слишком короткий:**
```
⚠️ Ответ слишком короткий

Минимальная длина ответа: 10 символов
Вы написали: 5 символов

Напишите более развернутый ответ

[Попробовать снова] [Отмена]
```

**1b. Обнаружен недопустимый контент:**
```
⚠️ Недопустимый контент

В вашем ответе обнаружены слова,
нарушающие правила сообщества

Пожалуйста, перефразируйте ответ
в вежливой форме

[Редактировать] [Отмена]
```

**1c. Редактирование существующего ответа:**
```
Редактирование ответа

У вас уже есть ответ на этот отзыв:

"Спасибо за ваш отзыв, Алия!..."

Опубликован: 20.01.2026

Хотите изменить?

⚠️ Изменения будут видны всем

[Редактировать] [Отмена]
```

**Шаблоны ответов:**

При выборе шаблона система подставляет текст, который можно редактировать:

**Шаблон для 5★:**
```
Спасибо за теплый отзыв, {ИМЯ_ГОСТЯ}! 
Очень рады, что вам понравилось. 
Будем рады видеть вас снова!
```

**Шаблон для 4★:**
```
Спасибо за ваш отзыв, {ИМЯ_ГОСТЯ}! 
Рады, что в целом все понравилось. 
Учтем ваши замечания для улучшения сервиса.
```

**Шаблон для 3★ и ниже:**
```
Спасибо за ваш честный отзыв, {ИМЯ_ГОСТЯ}. 
Сожалеем, что не оправдали ожидания. 
Мы уже работаем над устранением недостатков.
```

---

## 5. Аналитика и статистика

### Сценарий 5.1: Просмотр статистики по объекту

**Предусловия:**
- Риелтор владеет объектами
- Есть данные о бронированиях и просмотрах

**Основной поток (веб):**

1. Риелтор переходит в "Мои объекты" → выбирает объект → "📊 Статистика"
2. Система показывает дашборд:
   ```
   Статистика объекта
   
   🏠 Уютная 2-комнатная в центре (#12345)
   
   Период: [За последние 30 дней ▼] [Применить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📈 ОСНОВНЫЕ ПОКАЗАТЕЛИ
   
   ┌────────────────┬────────────────┬────────────────┐
   │ Просмотры      │ Бронирования   │ Конверсия      │
   ├────────────────┼────────────────┼────────────────┤
   │ 145            │ 8              │ 5.5%           │
   │ +12% к пред.   │ +25% к пред.   │ +1.2% к пред.  │
   └────────────────┴────────────────┴────────────────┘
   
   ┌────────────────┬────────────────┬────────────────┐
   │ Доход          │ Средний чек    │ Загрузка       │
   ├────────────────┼────────────────┼────────────────┤
   │ 120 000 ₸      │ 15 000 ₸       │ 40%            │
   │ +15% к пред.   │ +0% к пред.    │ (12 из 30 дн)  │
   └────────────────┴────────────────┴────────────────┘
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ГРАФИКИ
   
   Просмотры по дням:
   
        ▁ ▂ ▄ ▃ ▅ ▇ █ ▆ ▄ ▃ ▅ ▇ █ ▆ ▄
   15 │         ╱╲    ╱╲    ╱╲
   10 │    ╱╲  ╱  ╲  ╱  ╲  ╱  ╲
    5 │   ╱  ╲╱    ╲╱    ╲╱    ╲
    0 └──────────────────────────────
       1   5   10  15  20  25  30
   
   Бронирования: 8
   █ █   █ █     █   █  █   █
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🎯 ИСТОЧНИКИ ТРАФИКА
   
   Поиск на сайте:      85  (59%)  ████████████░░░░░
   Прямая ссылка:       40  (28%)  ██████░░░░░░░░░░░
   Избранное:           15  (10%)  ██░░░░░░░░░░░░░░░
   Повторные визиты:     5  (3%)   █░░░░░░░░░░░░░░░░
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⏱ СРЕДНИЕ ПОКАЗАТЕЛИ
   
   • Длительность брони: 3.2 ночи
   • Время до бронирования: 8.5 дней
   • Время ответа гостям: 2.3 часа
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⭐ ОТЗЫВЫ И РЕЙТИНГ
   
   Средний рейтинг: ⭐ 4.8 / 5.0
   Всего отзывов: 23
   
   Последние отзывы:
   • ⭐⭐⭐⭐⭐ Марат К. (29.12.2025)
   • ⭐⭐⭐⭐☆ Алия Н. (19.01.2026)
   
   [Все отзывы →]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💰 ФИНАНСЫ
   
   Заработано (после комиссии):
   За 30 дней:  108 000 ₸
   За год:      1 296 000 ₸
   
   Ожидается (будущие брони):
   Следующие 30 дней: 180 000 ₸
   
   [Финансовый отчет →]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📅 КАЛЕНДАРЬ ЗАГРУЗКИ
   
   Следующие 90 дней:
   
   Янв: ████████░░░░░░░░ 40% (12/30)
   Фев: ██████████████░░ 70% (20/28)
   Мар: ██████░░░░░░░░░░ 30% (9/31)
   
   [Открыть календарь →]
   ```

3. Риелтор может:
   - Менять период просмотра (неделя/месяц/квартал/год/все время)
   - Экспортировать данные в CSV/Excel
   - Перейти к детальным отчетам

**Основной поток (Telegram):**

1. Риелтор выбирает объект → "📊 Статистика"
2. Бот отправляет краткую сводку:
   ```
   📊 Статистика
   
   Уютная 2-комнатная в центре
   За последние 30 дней
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   👁 Просмотры: 145 (+12%)
   📋 Брони: 8 (+25%)
   💰 Доход: 120 000 ₸ (+15%)
   
   📈 Конверсия: 5.5%
   ⚡ Загрузка: 40% (12/30 дней)
   ⭐ Рейтинг: 4.8 (23 отзыва)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Динамика:
   
   Неделя 1: ▂▂▄▃▅ (4 брони)
   Неделя 2: ▃▅▇█▆ (2 брони)
   Неделя 3: ▄▃▅▇█ (1 бронь)
   Неделя 4: ▆▄▃▅▇ (1 бронь)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [📅 Другой период]
   [📥 Скачать отчет]
   [⬅️ К объекту]
   ```

3. При нажатии "Другой период" показывает варианты:
   - За 7 дней
   - За 30 дней
   - За 90 дней
   - За год
   - За все время

**Постусловия:**
- Риелтор понимает эффективность объекта
- Может принять решение об изменении цены
- Может улучшить описание или фото

---

### Сценарий 5.2: Сравнение своих объектов

**Предусловия:**
- Риелтор владеет несколькими объектами
- Есть данные для сравнения

**Основной поток (веб):**

1. Риелтор переходит "Панель риелтора" → "Аналитика" → "Сравнение объектов"
2. Система показывает сравнительную таблицу:
   ```
   Сравнение моих объектов
   
   Период: [За последние 30 дней ▼]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ТОП-5 ПО ДОХОДУ
   
   ┌────┬────────────────────────┬────────┬────────┐
   │ №  │ Объект                 │ Доход  │ Брони  │
   ├────┼────────────────────────┼────────┼────────┤
   │ 1  │ Уютная 2-комнатная     │120 000₸│   8    │
   │    │ ⭐ 4.8 | 🔥 40%         │        │        │
   ├────┼────────────────────────┼────────┼────────┤
   │ 2  │ 3-комнатная в центре   │ 95 000₸│   5    │
   │    │ ⭐ 4.6 | 🔥 35%         │        │        │
   ├────┼────────────────────────┼────────┼────────┤
   │ 3  │ Студия на Левобережье  │ 60 000₸│  10    │
   │    │ ⭐ 4.9 | 🔥 55%         │        │        │
   ├────┼────────────────────────┼────────┼────────┤
   │ 4  │ 1-комнатная квартира   │ 45 000₸│   7    │
   │    │ ⭐ 4.5 | 🔥 30%         │        │        │
   ├────┼────────────────────────┼────────┼────────┤
   │ 5  │ 2-комнатная на окраине │ 35 000₸│   4    │
   │    │ ⭐ 4.2 | 🔥 20%         │        │        │
   └────┴────────────────────────┴────────┴────────┘
   
   Всего доход: 355 000 ₸
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ТОП-5 ПО КОЛИЧЕСТВУ БРОНИРОВАНИЙ
   
   1. Студия на Левобережье    10 броней
   2. Уютная 2-комнатная        8 броней
   3. 1-комнатная квартира      7 броней
   4. 3-комнатная в центре      5 броней
   5. 2-комнатная на окраине    4 брони
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ ОБЪЕКТЫ, ТРЕБУЮЩИЕ ВНИМАНИЯ
   
   🔴 2-комнатная на окраине
   Проблемы:
   • Низкая загрузка (20%)
   • Мало просмотров (35)
   • Низкий рейтинг (4.2)
   
   Рекомендации:
   ✓ Обновите фотографии
   ✓ Снизьте цену на 10-15%
   ✓ Добавьте больше удобств в описание
   
   [Перейти к объекту] [Редактировать]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📈 ОБЩАЯ СТАТИСТИКА
   
   Активных объектов: 5
   Средняя загрузка: 36%
   Средний рейтинг: ⭐ 4.6
   Общий доход: 355 000 ₸
   ```

3. Риелтор может:
   - Сортировать по разным метрикам
   - Выбрать период
   - Перейти к конкретному объекту
   - Скачать отчет

**Основной поток (Telegram):**

1. Риелтор в панели админа → "📊 Статистика"
2. Выбирает "Сравнить объекты"
3. Бот показывает краткое сравнение:
   ```
   Сравнение объектов
   За последние 30 дней
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💰 ТОП по доходу:
   
   1️⃣ Уютная 2-комнатная
      120 000 ₸ | 8 броней
   
   2️⃣ 3-комнатная в центре
      95 000 ₸ | 5 броней
   
   3️⃣ Студия на Левобережье
      60 000 ₸ | 10 броней
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📋 ТОП по бронированиям:
   
   1️⃣ Студия на Левобережье (10)
   2️⃣ Уютная 2-комнатная (8)
   3️⃣ 1-комнатная квартира (7)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ Требуют внимания:
   
   • 2-комнатная на окраине
     Загрузка: 20% ⚠️
   
   [Детали] [Другой период]
   [🏢 Панель админа]
   ```

**Постусловия:**
- Риелтор понимает какие объекты работают лучше
- Может сфокусироваться на улучшении слабых объектов

---

### Сценарий 5.3: Экспорт отчетов

**Предусловия:**
- Риелтор хочет получить детальный отчет
- Есть данные за выбранный период

**Основной поток (веб):**

1. Риелтор в разделе статистики
2. Нажимает "📥 Экспортировать отчет"
3. Система показывает форму:
   ```
   Экспорт отчета
   
   ┌─────────────────────────────────────────────┐
   │ Период *                                    │
   ├─────────────────────────────────────────────┤
   │ ○ За последние 7 дней                       │
   │ ○ За последние 30 дней                      │
   │ ○ За последние 90 дней                      │
   │ ● Произвольный период:                      │
   │   С: [__/__/____] По: [__/__/____] 🗓      │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Данные для включения                        │
   ├─────────────────────────────────────────────┤
   │ ☑ Бронирования                              │
   │ ☑ Финансовые данные                         │
   │ ☑ Просмотры и конверсия                     │
   │ ☑ Отзывы                                    │
   │ ☐ Сообщения с гостями                       │
   └─────────────────────────────────────────────┘
   
   ┌─────────────────────────────────────────────┐
   │ Формат *                                    │
   ├─────────────────────────────────────────────┤
   │ ○ Excel (.xlsx) - для анализа              │
   │ ● CSV (.csv) - для импорта                 │
   │ ○ PDF (.pdf) - для печати                  │
   └─────────────────────────────────────────────┘
   
   [Отмена] [Создать отчет]
   ```

4. Риелтор выбирает параметры
5. Нажимает "Создать отчет"
6. Система генерирует отчет:
   ```python
   # Celery задача для генерации
   @shared_task
   def generate_report_task(realtor_id, params):
       realtor = User.objects.get(id=realtor_id)
       
       # Собираем данные
       bookings = Booking.objects.filter(
           property__owner=realtor,
           created_at__range=(params['start'], params['end'])
       )
       
       # Генерируем файл
       if params['format'] == 'xlsx':
           report_file = generate_excel_report(
               bookings, 
               params['include']
           )
       elif params['format'] == 'csv':
           report_file = generate_csv_report(
               bookings,
               params['include']
           )
       else:  # PDF
           report_file = generate_pdf_report(
               bookings,
               params['include']
           )
       
       # Сохраняем в Minio
       file_url = upload_to_minio(report_file)
       
       # Уведомляем
       notify_report_ready.delay(realtor_id, file_url)
   ```

7. Показывает прогресс:
   ```
   ⏳ Создание отчета...
   
   Собираем данные о бронированиях...  ✅
   Формируем финансовую сводку...      ⏳
   Добавляем отзывы...                 ⏸
   Генерируем файл...                  ⏸
   
   Примерное время: 1-2 минуты
   
   Вы получите уведомление когда отчет
   будет готов
   ```

8. После генерации показывает:
   ```
   ✅ Отчет готов!
   
   Финансовый отчет за 01.01-31.01.2026
   Формат: Excel (.xlsx)
   Размер: 245 КБ
   
   [💾 Скачать отчет] [📧 Отправить на email]
   ```

9. Риелтор скачивает файл
10. В email дублируется ссылка на скачивание

**Основной поток (Telegram):**

1. Риелтор в статистике → "📥 Скачать отчет"
2. Бот запрашивает параметры пошагово
3. Генерирует отчет
4. Отправляет файл:
   ```
   ✅ Отчет готов
   
   📄 Финансовый_отчет_январь_2026.xlsx
   Размер: 245 КБ
   
   [Файл для скачивания]
   
   📧 Также отправлен на email:
   realtor@example.com
   
   [🏢 Панель админа]
   ```

**Альтернативные потоки:**

**1a. Нет данных за период:**
```
⚠️ Нет данных

За выбранный период (01-07 янв 2026)
нет бронирований или других данных

Выберите другой период

[Выбрать период] [Отмена]
```

**1b. Ошибка генерации:**
```
❌ Ошибка создания отчета

Не удалось создать отчет.
Попробуйте еще раз или обратитесь
в поддержку

[Попробовать снова] [☎️ Поддержка]
```

---

## 6. Уведомления

### Сценарий 6.1: Получение уведомлений о новых бронях

**Предусловия:**
- Риелтор владеет объектами
- Кто-то создает бронирование

**Основной поток (email):**

1. Гость бронирует объект риелтора
2. Система отправляет email риелтору:
   ```
   Тема: 🎉 Новое бронирование #BR-12347
   
   Здравствуйте!
   
   У вас новое бронирование:
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📋 ДЕТАЛИ БРОНИРОВАНИЯ
   
   Номер брони: #BR-12347
   Объект: Уютная 2-комнатная в центре
   
   Гость: Дамир Турсунов
   Телефон: +7 777 555 4433
   Email: damir.t@example.com
   
   Даты:
   Заезд: 05 февраля 2026 в 14:00
   Выезд: 10 февраля 2026 в 12:00
   Ночей: 5
   
   Оплата:
   Сумма: 25 000 ₸
   Статус: ✅ Оплачено (Kaspi Pay)
   
   Комментарий гостя:
   "Приеду с семьей (2 взрослых + 2 детей)"
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ЧТО ДЕЛАТЬ ДАЛЬШЕ:
   
   1. Подтвердите готовность объекта
   2. Свяжитесь с гостем (при необходимости)
   3. Подготовьте жилье к заезду
   
   [Посмотреть бронь в системе]
   [Написать гостю]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   С уважением,
   Команда ЖильеGO
   ```

**Основной поток (Telegram):**

1. Создается новая бронь
2. Бот отправляет риелтору:
   ```
   🎉 НОВОЕ БРОНИРОВАНИЕ!
   
   #BR-12347
   
   🏠 Уютная 2-комнатная в центре
   
   👤 Дамир Турсунов
   📱 +7 777 555 4433
   
   📅 05 фев (14:00) → 10 фев (12:00)
   🛏 5 ночей
   
   💰 25 000 ₸ ✅ Оплачено (Kaspi)
   
   💬 Комментарий:
   "Приеду с семьей (2 взрослых + 2 детей)"
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   До заезда: 12 дней
   
   [📋 Открыть бронь]
   [💬 Написать гостю]
   [📅 Календарь]
   ```

3. Риелтор может сразу:
   - Открыть детали брони
   - Написать гостю
   - Посмотреть календарь

**Настройки уведомлений:**

Риелтор может настроить в профиле:
```
Настройки уведомлений

┌─────────────────────────────────────────────┐
│ EMAIL УВЕДОМЛЕНИЯ                           │
├─────────────────────────────────────────────┤
│ ☑ Новые бронирования                        │
│ ☑ Отмены бронирований                       │
│ ☑ Новые сообщения от гостей                 │
│ ☑ Новые отзывы                              │
│ ☐ Еженедельная сводка                       │
│ ☐ Ежемесячный отчет                         │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ TELEGRAM УВЕДОМЛЕНИЯ                        │
├─────────────────────────────────────────────┤
│ ☑ Новые бронирования (мгновенно)           │
│ ☑ Отмены бронирований                       │
│ ☑ Сообщения от гостей                       │
│ ☑ Новые отзывы                              │
│ ☑ Напоминания о заездах (за 1 день)        │
│ ☐ Ежедневная сводка (9:00)                 │
└─────────────────────────────────────────────┘

[Сохранить настройки]
```

**Постусловия:**
- Риелтор моментально узнает о новой брони
- Может оперативно связаться с гостем
- Может подготовить объект

---

### Сценарий 6.2: Напоминания о предстоящих заездах

**Предусловия:**
- Риелтор имеет будущие бронирования
- До заезда остается 1 день

**Основной поток:**

1. За 24 часа до заезда Celery задача:
   ```python
   @shared_task
   def send_checkin_reminders():
       tomorrow = timezone.now().date() + timedelta(days=1)
       
       # Находим брони на завтра
       upcoming_bookings = Booking.objects.filter(
           check_in__date=tomorrow,
           status='confirmed'
       )
       
       for booking in upcoming_bookings:
           realtor = booking.property.owner
           
           # Отправляем уведомление
           send_telegram_notification(
               user=realtor,
               message=format_checkin_reminder(booking)
           )
           
           send_email_notification(
               user=realtor,
               subject=f"Завтра заезд: {booking.property.name}",
               template='checkin_reminder',
               context={'booking': booking}
           )
   ```

2. Риелтор получает в Telegram:
   ```
   ⏰ НАПОМИНАНИЕ О ЗАЕЗДЕ
   
   Завтра заселяется гость:
   
   🏠 Уютная 2-комнатная в центре
   
   👤 Дамир Турсунов
   📱 +7 777 555 4433
   
   📅 Заезд: завтра, 5 февраля в 14:00
   🛏 Проживание: 5 ночей
   
   ✅ Что проверить:
   • Объект чист и готов
   • Постельное белье свежее
   • Коды доступа работают
   • Все удобства в порядке
   
   [📋 Открыть бронь]
   [💬 Написать гостю]
   [✅ Отметить готовность]
   ```

3. Риелтор может:
   - Открыть детали
   - Связаться с гостем
   - Отметить, что все готово

4. При нажатии "✅ Отметить готовность":
   ```
   Объект готов к заезду?
   
   Подтвердите, что:
   ☑ Квартира убрана
   ☑ Белье постелено
   ☑ Коды работают
   ☑ Все удобства в порядке
   
   [✅ Да, все готово] [⚠️ Есть проблемы]
   ```

5. Если "Да, все готово":
   ```
   ✅ Отлично!
   
   Готовность подтверждена
   Приятного заезда гостю!
   
   [OK]
   ```

6. Если "Есть проблемы":
   ```
   Что случилось?
   
   [🔧 Поломка]
   [🧹 Не успели убрать]
   [🔑 Проблема с доступом]
   [✏️ Другое]
   ```
   
   Затем предлагает связаться с гостем или поддержкой

**Дополнительные напоминания:**

За 2 часа до заезда:
```
⏰ Заезд через 2 часа!

Дамир Турсунов
Уютная 2-комнатная
Заезд в 14:00

Все готово? ✅
```

**Постусловия:**
- Риелтор не забывает о предстоящих заездах
- Успевает подготовить объект
- Гость получает готовое жилье

---

## Итоги по роли "Риелтор (Администратор)"

### Реализованные сценарии:

✅ **1. Управление объектами (6 сценариев)**
- 1.1 Добавление объекта (веб)
- 1.2 Добавление объекта (Telegram)
- 1.3 Просмотр своих объектов
- 1.4 Редактирование объекта
- 1.5 Деактивация/активация объекта
- 1.6 Удаление объекта

✅ **2. Управление бронированиями (4 сценария)**
- 2.1 Просмотр бронирований
- 2.2 Подтверждение оплаты вручную
- 2.3 Отмена бронирования
- 2.4 Общение с гостем

✅ **3. Календарь и доступность (3 сценария)**
- 3.1 Просмотр календаря занятости
- 3.2 Блокировка дат вручную
- 3.3 Массовая блокировка периода

✅ **4. Работа с отзывами (2 сценария)**
- 4.1 Просмотр отзывов
- 4.2 Ответ на отзыв

✅ **5. Аналитика и статистика (3 сценария)**
- 5.1 Просмотр статистики по объекту
- 5.2 Сравнение своих объектов
- 5.3 Экспорт отчетов

✅ **6. Уведомления (2 сценария)**
- 6.1 Получение уведомлений о новых бронях
- 6.2 Напоминания о предстоящих заездах

### Всего: 20 детальных сценариев

### Основные возможности риелтора:
- Полное управление своими объектами
- Мониторинг и работа с бронированиями
- Управление календарем доступности
- Взаимодействие с отзывами
- Детальная аналитика эффективности
- Система уведомлений

### Интерфейсы:
- Веб-приложение (Django админ-панель)
- Telegram-бот (полная функциональность)

---

# Документ для роли "Риелтор" завершен!

Готово к переходу на следующие роли:
- Супер Админ (Руководитель риелторов)
- Суперпользователь

