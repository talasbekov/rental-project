# ЖильеGO — Сценарии использования
## Роль: Суперпользователь (Глобальный Администратор)

**Дата:** 26 октября 2025  
**Версия:** 1.0  
**Статус:** ✅ Полная версия

---

## 📋 Содержание

### 0. Роль и права доступа
### 1. Управление платформой
   - 1.1 Глобальный дашборд
   - 1.2 Системные настройки
   - 1.3 Мониторинг состояния системы
### 2. Управление агентствами
   - 2.1 Список всех агентств
   - 2.2 Добавление агентства
   - 2.3 Редактирование агентства
   - 2.4 Деактивация агентства
   - 2.5 Детальная статистика агентства
### 3. Управление пользователями
   - 3.1 Список всех пользователей
   - 3.2 Поиск пользователя
   - 3.3 Редактирование пользователя
   - 3.4 Блокировка/разблокировка
   - 3.5 Назначение ролей
### 4. Глобальная аналитика
   - 4.1 Общая статистика платформы
   - 4.2 ТОП-5 агентств
   - 4.3 ТОП-5 риелторов (глобально)
   - 4.4 ТОП-5 квартир (глобально)
   - 4.5 ТОП-5 пользователей (глобально)
   - 4.6 География и расширение
   - 4.7 Динамика роста платформы
### 5. Финансы платформы
   - 5.1 Общий доход платформы
   - 5.2 Доходы по агентствам
   - 5.3 Доходы по городам
   - 5.4 Структура комиссий
   - 5.5 Финансовые прогнозы
### 6. Управление контентом
   - 6.1 Модерация объектов
   - 6.2 Модерация отзывов
   - 6.3 Управление городами и районами
   - 6.4 Управление типами жилья
### 7. Аналитика качества
   - 7.1 Анализ отзывов и рейтингов
   - 7.2 Heat map занятости (глобальный)
   - 7.3 История цен
   - 7.4 Конверсия и воронка бронирований
### 8. Маркетинг и продвижение
   - 8.1 Источники трафика
   - 8.2 Эффективность рекламных каналов
   - 8.3 Когортный анализ
### 9. Безопасность и логи
   - 9.1 Журнал действий администраторов
   - 9.2 Подозрительная активность
   - 9.3 Аудит доступа к конфиденциальным данным
### 10. Отчетность и экспорт
   - 10.1 Комплексные отчеты
   - 10.2 Автоматические рассылки
   - 10.3 API для интеграций

---

## 0. Роль и права доступа

### Определение роли

**Суперпользователь** — владелец/главный администратор платформы ЖильеGO с максимальными правами доступа ко всем данным и функциям системы.

### Права доступа

**Суперпользователь имеет:**
- ✅ Все права Супер Админа
- ✅ Доступ к данным ВСЕХ агентств
- ✅ Управление всеми агентствами и пользователями
- ✅ Глобальную аналитику по всей платформе
- ✅ Финансовые данные всей платформы
- ✅ Системные настройки и конфигурацию
- ✅ Доступ к логам и безопасности
- ✅ Управление справочниками (города, районы, типы)
- ✅ Модерацию всего контента

**Ограничений нет** — это высшая роль в системе.

### Модель данных

```python
class CustomUser(AbstractUser):
    """Расширенная модель пользователя"""
    ROLE_CHOICES = [
        ('guest', 'Гость'),
        ('realtor', 'Риелтор'),
        ('super_admin', 'Супер Админ'),
        ('superuser', 'Суперпользователь'),  # Высшая роль
    ]
    
    role = models.CharField(max_length=20, choices=ROLE_CHOICES, default='guest')
    agency = models.ForeignKey(RealEstateAgency, null=True, blank=True,
                               related_name='employees')
    
    # Для Суперпользователя agency = None (он выше агентств)
    
    def is_superuser_role(self):
        return self.role == 'superuser'
```

---

## 1. Управление платформой

### Сценарий 1.1: Глобальный дашборд

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит на главную страницу или в раздел "🌍 Дашборд"
2. Система показывает глобальный обзор:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🌍 ГЛОБАЛЬНЫЙ ДАШБОРД ПЛАТФОРМЫ
   
   ЖильеGO — Посуточная аренда жилья
   Обновлено: 26.10.2025 14:35
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 КЛЮЧЕВЫЕ МЕТРИКИ
   
   ┌─────────────────────┬───────────────────┬──────────────────┐
   │ 💰 Общий оборот     │ 📅 Бронирования   │ 👥 Пользователи  │
   ├─────────────────────┼───────────────────┼──────────────────┤
   │ 45,850,000₸         │ 2,458             │ 15,234           │
   │ +18.5% ↑            │ +22.3% ↑          │ +15.7% ↑         │
   │ за текущий месяц    │ за текущий месяц  │ активных         │
   └─────────────────────┴───────────────────┴──────────────────┘
   
   ┌─────────────────────┬───────────────────┬──────────────────┐
   │ 🏢 Агентства        │ 👨‍💼 Риелторы       │ 🏠 Объекты       │
   ├─────────────────────┼───────────────────┼──────────────────┤
   │ 24                  │ 187               │ 892              │
   │ +2 за месяц         │ активных          │ активных         │
   │ 22 активных         │ +12 за месяц      │ +45 за месяц     │
   └─────────────────────┴───────────────────┴──────────────────┘
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📈 ДИНАМИКА ОБОРОТА (ПОСЛЕДНИЕ 6 МЕСЯЦЕВ)
   
        50M ┤                                   ╭─
        45M ┤                             ╭─────╯
        40M ┤                       ╭─────╯
        35M ┤                 ╭─────╯
        30M ┤           ╭─────╯
        25M ┤     ╭─────╯
        20M ┤─────╯
            └─┬─────┬─────┬─────┬─────┬─────┬─────┬──>
             Май   Июн   Июл   Авг   Сен   Окт   Ноя
   
   Прогноз на ноябрь: ~48,500,000₸ (+5.8%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🗺️ ГЕОГРАФИЯ ПЛАТФОРМЫ
   
   Города: 3 (Астана, Алматы, Шымкент)
   Районы: 28
   Охват: Казахстан
   
   По городам:
   🏙️ Астана:   514 объектов | 1,485 броней | 28,450,000₸ (62%)
   🏙️ Алматы:   298 объектов |   782 брони  | 14,280,000₸ (31%)
   🏙️ Шымкент:   80 объектов |   191 бронь  |  3,120,000₸ (7%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💼 ТОП-3 АГЕНТСТВА
   
   1. 🥇 Астана Элит Недвижимость
      💰 4,850,000₸/мес | 📍 67 объектов | 👥 8 риелторов
   
   2. 🥈 Алматы Премиум Хоум
      💰 3,980,000₸/мес | 📍 58 объектов | 👥 6 риелторов
   
   3. 🥉 Столичная Недвижимость
      💰 3,450,000₸/мес | 📍 52 объектов | 👥 7 риелторов
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ЭФФЕКТИВНОСТЬ ПЛАТФОРМЫ
   
   ┌─────────────────────────────────┬──────────────────────────┐
   │ Средняя загрузка объектов       │ 54.3% (+2.1%)            │
   │ Средний рейтинг платформы       │ ⭐ 4.6 (+0.1)            │
   │ Конверсия бронирований          │ 68.5% (+3.2%)            │
   │ Повторные бронирования          │ 23.4% (+1.8%)            │
   │ Средний чек                     │ 18,660₸ (+2.5%)          │
   │ Средняя длительность            │ 3.1 ночи                 │
   │ % отмен                         │ 4.8% (-0.5%)             │
   └─────────────────────────────────┴──────────────────────────┘
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ ТРЕБУЕТ ВНИМАНИЯ
   
   • 3 агентства с низкой активностью (<20 броней/мес)
   • 12 объектов без броней более 30 дней
   • 5 риелторов с рейтингом ниже 4.0
   • 2 случая двойного бронирования за неделю
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🎯 ЦЕЛИ И ПРОГРЕСС
   
   Цель месяца: 50,000,000₸
   Прогресс: ████████████████░░░░ 91.7% (45,850,000₸)
   
   Цель по объектам: 1000
   Прогресс: ██████████████████░░ 89.2% (892)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [📊 Детальная аналитика] [💼 Агентства] [👥 Пользователи]
   [🏠 Объекты] [💰 Финансы] [⚙️ Настройки] [📥 Экспорт]
   ```

**Код дашборда:**

```python
def get_global_dashboard(period='current_month'):
    """Получение данных для глобального дашборда"""
    
    start_date, end_date = get_period_dates(period)
    prev_start, prev_end = get_previous_period_dates(period)
    
    # === ОБЩИЕ МЕТРИКИ ===
    
    # Оборот
    current_revenue = Booking.objects.filter(
        status__in=['paid', 'completed'],
        created_at__gte=start_date,
        created_at__lte=end_date
    ).aggregate(
        total=Coalesce(Sum('total_price'), Decimal('0'))
    )['total']
    
    prev_revenue = Booking.objects.filter(
        status__in=['paid', 'completed'],
        created_at__gte=prev_start,
        created_at__lte=prev_end
    ).aggregate(
        total=Coalesce(Sum('total_price'), Decimal('0'))
    )['total']
    
    revenue_growth = calculate_growth(current_revenue, prev_revenue)
    
    # Бронирования
    current_bookings = Booking.objects.filter(
        created_at__gte=start_date,
        created_at__lte=end_date
    ).count()
    
    prev_bookings = Booking.objects.filter(
        created_at__gte=prev_start,
        created_at__lte=prev_end
    ).count()
    
    bookings_growth = calculate_growth(current_bookings, prev_bookings)
    
    # Пользователи
    active_users = CustomUser.objects.filter(
        role='guest',
        is_active=True,
        last_login__gte=start_date
    ).count()
    
    # Агентства
    total_agencies = RealEstateAgency.objects.count()
    active_agencies = RealEstateAgency.objects.filter(is_active=True).count()
    new_agencies_this_month = RealEstateAgency.objects.filter(
        created_at__gte=start_date
    ).count()
    
    # Риелторы
    active_realtors = CustomUser.objects.filter(
        role='realtor',
        is_active=True
    ).count()
    
    new_realtors_this_month = CustomUser.objects.filter(
        role='realtor',
        created_at__gte=start_date
    ).count()
    
    # Объекты
    active_properties = Property.objects.filter(is_active=True).count()
    new_properties_this_month = Property.objects.filter(
        created_at__gte=start_date
    ).count()
    
    # === ГЕОГРАФИЯ ===
    
    cities_stats = Property.objects.values(
        'city__name'
    ).annotate(
        properties_count=Count('id'),
        bookings_count=Count('bookings',
                            filter=Q(bookings__created_at__gte=start_date,
                                    bookings__created_at__lte=end_date)),
        revenue=Coalesce(
            Sum('bookings__total_price',
                filter=Q(bookings__status__in=['paid', 'completed'],
                        bookings__created_at__gte=start_date,
                        bookings__created_at__lte=end_date)),
            Decimal('0')
        )
    ).order_by('-revenue')
    
    # === ТОП-3 АГЕНТСТВА ===
    
    top_agencies = RealEstateAgency.objects.annotate(
        revenue=Coalesce(
            Sum('employees__properties__bookings__total_price',
                filter=Q(employees__properties__bookings__status__in=['paid', 'completed'],
                        employees__properties__bookings__created_at__gte=start_date,
                        employees__properties__bookings__created_at__lte=end_date)),
            Decimal('0')
        ),
        properties_count=Count('employees__properties', distinct=True),
        realtors_count=Count('employees',
                            filter=Q(employees__role='realtor',
                                    employees__is_active=True),
                            distinct=True)
    ).order_by('-revenue')[:3]
    
    # === ЭФФЕКТИВНОСТЬ ===
    
    # Средняя загрузка
    avg_occupancy = Property.objects.aggregate(
        avg=Avg(
            ExpressionWrapper(
                Count('bookings',
                      filter=Q(bookings__status__in=['confirmed', 'completed'],
                              bookings__check_in__gte=start_date,
                              bookings__check_in__lte=end_date)) * 100.0 /
                (end_date - start_date).days,
                output_field=FloatField()
            )
        )
    )['avg'] or 0
    
    # Средний рейтинг
    avg_rating = Review.objects.aggregate(
        avg=Avg('rating')
    )['avg'] or 0
    
    # Конверсия (упрощенно)
    total_searches = SearchLog.objects.filter(
        created_at__gte=start_date,
        created_at__lte=end_date
    ).count()
    
    conversion_rate = (current_bookings / total_searches * 100) if total_searches > 0 else 0
    
    # Повторные бронирования
    repeat_bookings = Booking.objects.filter(
        created_at__gte=start_date,
        created_at__lte=end_date,
        user__in=Booking.objects.filter(
            created_at__lt=start_date
        ).values_list('user_id', flat=True)
    ).count()
    
    repeat_rate = (repeat_bookings / current_bookings * 100) if current_bookings > 0 else 0
    
    # Средний чек
    avg_check = Booking.objects.filter(
        status__in=['paid', 'completed'],
        created_at__gte=start_date,
        created_at__lte=end_date
    ).aggregate(
        avg=Avg('total_price')
    )['avg'] or Decimal('0')
    
    # % отмен
    cancelled_bookings = Booking.objects.filter(
        status='cancelled',
        created_at__gte=start_date,
        created_at__lte=end_date
    ).count()
    
    cancellation_rate = (cancelled_bookings / current_bookings * 100) if current_bookings > 0 else 0
    
    # === ПРОБЛЕМЫ ===
    
    low_activity_agencies = RealEstateAgency.objects.annotate(
        bookings_count=Count('employees__properties__bookings',
                            filter=Q(employees__properties__bookings__created_at__gte=start_date,
                                    employees__properties__bookings__created_at__lte=end_date))
    ).filter(bookings_count__lt=20).count()
    
    zero_bookings_properties = Property.objects.annotate(
        last_booking=Max('bookings__created_at')
    ).filter(
        Q(last_booking__lt=timezone.now() - timezone.timedelta(days=30)) |
        Q(last_booking__isnull=True)
    ).count()
    
    low_rated_realtors = CustomUser.objects.filter(
        role='realtor',
        is_active=True
    ).annotate(
        avg_rating=Avg('properties__reviews__rating')
    ).filter(avg_rating__lt=4.0).count()
    
    double_bookings_week = find_double_bookings(
        start_date=timezone.now() - timezone.timedelta(days=7),
        end_date=timezone.now()
    )
    
    return {
        'metrics': {
            'revenue': {
                'current': current_revenue,
                'growth': revenue_growth
            },
            'bookings': {
                'current': current_bookings,
                'growth': bookings_growth
            },
            'users': {
                'active': active_users
            },
            'agencies': {
                'total': total_agencies,
                'active': active_agencies,
                'new_this_month': new_agencies_this_month
            },
            'realtors': {
                'active': active_realtors,
                'new_this_month': new_realtors_this_month
            },
            'properties': {
                'active': active_properties,
                'new_this_month': new_properties_this_month
            }
        },
        'geography': {
            'cities': cities_stats,
            'total_cities': City.objects.count(),
            'total_districts': District.objects.count()
        },
        'top_agencies': top_agencies,
        'efficiency': {
            'avg_occupancy': round(avg_occupancy, 1),
            'avg_rating': round(avg_rating, 1),
            'conversion_rate': round(conversion_rate, 1),
            'repeat_rate': round(repeat_rate, 1),
            'avg_check': avg_check,
            'cancellation_rate': round(cancellation_rate, 1)
        },
        'alerts': {
            'low_activity_agencies': low_activity_agencies,
            'zero_bookings_properties': zero_bookings_properties,
            'low_rated_realtors': low_rated_realtors,
            'double_bookings_week': len(double_bookings_week)
        }
    }
```

**Основной поток (Telegram):**

1. Суперпользователь: "📊 Дашборд"
2. Бот отправляет краткую сводку:
   ```
   🌍 Глобальный дашборд
   
   💰 Оборот: 45,850,000₸
   📈 +18.5%
   
   📅 Бронирований: 2,458
   👥 Активных пользователей: 15,234
   
   🏢 Агентств: 24 (22 активных)
   👨‍💼 Риелторов: 187
   🏠 Объектов: 892
   
   ⭐ Средний рейтинг: 4.6
   📊 Загрузка: 54.3%
   
   ━━━━━━━━━━━━━━━━━━━━━━
   
   [📊 Детальная аналитика]
   [💼 Агентства]
   [👥 Пользователи]
   [💰 Финансы]
   [⬅️ Назад]
   ```

**Постусловия:**
- Суперпользователь получил полный обзор состояния платформы
- Видит ключевые метрики и тренды
- Может перейти к детальному анализу

---

### Сценарий 1.2: Системные настройки

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит в "⚙️ Настройки системы"
2. Система показывает разделы настроек:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚙️ СИСТЕМНЫЕ НАСТРОЙКИ
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📋 ОБЩИЕ НАСТРОЙКИ
   
   Название платформы:
   [ЖильеGO____________________________]
   
   Базовая валюта:
   [₸ Тенге (KZT) ▼]
   
   Часовой пояс:
   [Asia/Almaty ▼]
   
   Языки:
   [x] Русский (по умолчанию)
   [x] Казахский
   [ ] Английский
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💳 НАСТРОЙКИ ОПЛАТЫ
   
   Платежные системы:
   [x] Kaspi Pay (настроено)
   [ ] Visa/Mastercard (не настроено)
   [ ] PayPal (недоступно)
   
   Комиссия платформы:
   [5] % от суммы бронирования
   
   Автоотмена неоплаченных броней:
   [x] Включено
   Через: [24] часов
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📸 НАСТРОЙКИ КОНТЕНТА
   
   Максимум фото на объект:
   [6] шт
   
   Максимальный размер фото:
   [5] МБ
   
   Модерация новых объектов:
   (*) Требуется модерация
   ( ) Публикуется сразу
   
   Модерация отзывов:
   (*) Требуется модерация
   ( ) Публикуется сразу
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📧 УВЕДОМЛЕНИЯ
   
   Email сервер:
   [x] Настроено (SMTP)
   
   Telegram бот:
   [x] Подключен (@zhiliego_bot)
   
   SMS уведомления:
   [ ] Не настроено
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🔐 БЕЗОПАСНОСТЬ
   
   Двухфакторная аутентификация:
   [x] Обязательна для администраторов
   [ ] Обязательна для всех
   
   Время сессии:
   [7] дней для пользователей
   [1] день для администраторов
   
   Блокировка после неудачных попыток:
   [x] Включено (5 попыток)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 АНАЛИТИКА
   
   Google Analytics:
   [x] Подключено (GA4)
   ID: [G-XXXXXXXXXX]
   
   Яндекс.Метрика:
   [x] Подключено
   ID: [12345678]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [Отмена] [Сохранить изменения]
   ```

3. Суперпользователь вносит изменения
4. Нажимает "Сохранить"
5. Система применяет настройки и перезапускает необходимые сервисы

**Код сохранения настроек:**

```python
def update_system_settings(user, settings_data):
    """Обновление системных настроек"""
    
    if not user.is_superuser_role():
        raise PermissionError("Только суперпользователь может изменять настройки")
    
    with transaction.atomic():
        # Получаем или создаем объект настроек
        config, created = SystemConfiguration.objects.get_or_create(pk=1)
        
        # Обновляем поля
        for key, value in settings_data.items():
            if hasattr(config, key):
                old_value = getattr(config, key)
                setattr(config, key, value)
                
                # Логируем изменение
                ConfigurationChangeLog.objects.create(
                    changed_by=user,
                    setting_name=key,
                    old_value=str(old_value),
                    new_value=str(value),
                    changed_at=timezone.now()
                )
        
        config.save()
        
        # Применяем критичные изменения
        if 'payment_commission' in settings_data:
            # Пересчитываем комиссии для будущих броней
            update_commission_calculations.delay()
        
        if 'auto_cancel_hours' in settings_data:
            # Перепланируем задачи отмены
            reschedule_auto_cancellation_tasks.delay()
        
        # Очищаем кеш настроек
        cache.delete('system_configuration')
        
        return config
```

**Постусловия:**
- Настройки обновлены
- Изменения залогированы
- Система работает с новыми параметрами

---

### Сценарий 1.3: Мониторинг состояния системы

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит в "🔍 Мониторинг системы"
2. Система показывает техническое состояние:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🔍 МОНИТОРИНГ СИСТЕМЫ
   
   Обновлено: 26.10.2025 14:35 (автообновление)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ✅ СТАТУС СЕРВИСОВ
   
   🟢 Веб-сервер (Django):      Работает (uptime: 45 дней)
   🟢 База данных (PostgreSQL): Работает (connections: 45/100)
   🟢 Кеш (Redis):              Работает (memory: 1.2GB/4GB)
   🟢 Очереди (Celery):         Работает (workers: 4, tasks: 12)
   🟢 Файлы (Minio S3):         Работает (storage: 45GB/200GB)
   🟢 Telegram бот:             Работает (online)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💻 РЕСУРСЫ СЕРВЕРА
   
   CPU:    ████████░░ 38%
   RAM:    ██████████░░ 65% (5.2GB / 8GB)
   Disk:   ████░░░░░░ 23% (45GB / 200GB)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ПРОИЗВОДИТЕЛЬНОСТЬ
   
   Среднее время ответа: 245ms
   Запросов в минуту: 340
   Ошибок 5xx за час: 2 (0.01%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📋 ОЧЕРЕДЬ ЗАДАЧ (CELERY)
   
   В очереди: 12 задач
   • send_email: 5
   • generate_report: 3
   • process_payment: 2
   • update_statistics: 2
   
   Выполнено за час: 1,234 задач
   Ошибок за час: 3
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🗄️ БАЗА ДАННЫХ
   
   Размер БД: 3.2 GB
   Таблицы: 45
   Записей:
   • Пользователи: 15,234
   • Объекты: 892
   • Бронирования: 28,456
   • Отзывы: 3,245
   
   Последний бэкап: 26.10.2025 03:00 ✅
   Следующий бэкап: 27.10.2025 03:00
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠️ ПРЕДУПРЕЖДЕНИЯ
   
   • Celery worker #3: высокая нагрузка (85%)
   • Redis: приближается к лимиту памяти (80%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [🔄 Обновить] [📊 История] [⚙️ Настройки]
   ```

**Постусловия:**
- Суперпользователь видит техническое состояние
- Может выявить проблемы до их критичности
- Может принять меры по оптимизации

---

## 2. Управление агентствами

### Сценарий 2.1: Список всех агентств

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит в "🏢 Агентства"
2. Система показывает список:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏢 ВСЕ АГЕНТСТВА ПЛАТФОРМЫ
   
   Всего: 24 агентства
   • Активных: 22
   • Неактивных: 2
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [🔍 Поиск агентства...]  [➕ Добавить]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Сортировка: [По доходу ↓]
   Фильтры:
   [x] Только активные
   [ ] Только неактивные
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ┌─────────────────────────────────────┐
   │ 1. ✅ Астана Элит Недвижимость      │
   │                                     │
   │ 📍 Астана                           │
   │ 📱 +7 777 000 0001                  │
   │ 📧 info@astana-elit.kz              │
   │                                     │
   │ 👥 Руководитель: Нурлан Смагулов    │
   │ 👨‍💼 Риелторов: 8 (все активны)       │
   │ 🏠 Объектов: 67                     │
   │                                     │
   │ 💰 Доход (месяц): 4,850,000₸        │
   │ 📊 Загрузка: 54%                    │
   │ ⭐ Рейтинг: 4.7                     │
   │                                     │
   │ Зарегистрировано: 15.01.2024        │
   │ Статус: 🟢 Активно                  │
   │                                     │
   │ [📊 Статистика] [✏️ Редактировать]  │
   │ [👥 Риелторы] [🏠 Объекты]          │
   └─────────────────────────────────────┘
   
   ┌─────────────────────────────────────┐
   │ 2. ✅ Алматы Премиум Хоум           │
   │                                     │
   │ 📍 Алматы                           │
   │ 📱 +7 707 000 0002                  │
   │ 📧 info@almaty-premium.kz           │
   │                                     │
   │ 👥 Руководитель: Айгуль Токаева     │
   │ 👨‍💼 Риелторов: 6                     │
   │ 🏠 Объектов: 58                     │
   │                                     │
   │ 💰 Доход (месяц): 3,980,000₸        │
   │ 📊 Загрузка: 62%                    │
   │ ⭐ Рейтинг: 4.8                     │
   │                                     │
   │ Зарегистрировано: 20.02.2024        │
   │ Статус: 🟢 Активно                  │
   │                                     │
   │ [📊 Статистика] [✏️ Редактировать]  │
   └─────────────────────────────────────┘
   
   [Показать еще...]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 СВОДКА
   • Общий доход: 45,850,000₸
   • Средний доход: 1,910,417₸
   • Средняя загрузка: 57%
   
   [📥 Экспорт списка] [📊 Сравнить все]
   ```

**Код получения агентств:**

```python
def get_all_agencies(filters=None, order_by='-revenue'):
    """Получение всех агентств с метриками"""
    
    start_date, end_date = get_period_dates('current_month')
    
    agencies = RealEstateAgency.objects.annotate(
        # Количество риелторов
        realtors_count=Count('employees',
                            filter=Q(employees__role='realtor'),
                            distinct=True),
        
        active_realtors_count=Count('employees',
                                   filter=Q(employees__role='realtor',
                                          employees__is_active=True),
                                   distinct=True),
        
        # Количество объектов
        properties_count=Count('employees__properties',
                              filter=Q(employees__role='realtor'),
                              distinct=True),
        
        # Доход
        revenue=Coalesce(
            Sum('employees__properties__bookings__total_price',
                filter=Q(employees__properties__bookings__status__in=['paid', 'completed'],
                        employees__properties__bookings__created_at__gte=start_date,
                        employees__properties__bookings__created_at__lte=end_date)),
            Decimal('0')
        ),
        
        # Загрузка
        occupancy_rate=Avg(
            ExpressionWrapper(
                Count('employees__properties__bookings',
                      filter=Q(employees__properties__bookings__status__in=['confirmed', 'completed'],
                              employees__properties__bookings__check_in__gte=start_date,
                              employees__properties__bookings__check_in__lte=end_date),
                      distinct=True) * 100.0 /
                (end_date - start_date).days,
                output_field=FloatField()
            )
        ),
        
        # Рейтинг
        avg_rating=Avg('employees__properties__reviews__rating')
    ).select_related('super_admin')
    
    # Применяем фильтры
    if filters:
        if filters.get('active_only'):
            agencies = agencies.filter(is_active=True)
        if filters.get('city_id'):
            agencies = agencies.filter(city_id=filters['city_id'])
    
    # Сортировка
    agencies = agencies.order_by(order_by)
    
    return agencies
```

**Постусловия:**
- Суперпользователь видит все агентства
- Может сравнивать их эффективность
- Может перейти к детальной информации

---

### Сценарий 2.2: Добавление агентства

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь нажимает "➕ Добавить агентство"
2. Открывается форма:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ➕ ДОБАВЛЕНИЕ АГЕНТСТВА
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Данные агентства:
   
   Название: *
   [Астана Премиум Недвижимость________]
   
   Город:
   [Астана ▼]
   
   Телефон: *
   [+7 777 123 4567____________________]
   
   Email: *
   [info@astana-premium.kz_____________]
   
   Описание:
   [Современное агентство недвижимости_]
   [специализируется на премиум________]
   [сегменте посуточной аренды._________]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Руководитель (Супер Админ):
   
   Создать нового пользователя:
   
   Имя: *
   [Марат______________________________]
   
   Фамилия: *
   [Токаев_____________________________]
   
   Email: *
   [marat.tokaev@gmail.com_____________]
   
   Телефон: *
   [+7 777 234 5678____________________]
   
   Временный пароль:
   [●●●●●●●●] [👁️] [🎲 Сгенерировать]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Настройки:
   
   Комиссия агентства от брони:
   [10] %
   
   Лимит объектов:
   [100] (0 = без лимита)
   
   Лимит риелторов:
   [20] (0 = без лимита)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ☑️ Отправить данные руководителю
   ☑️ Активировать агентство сразу
   
   [Отмена] [Создать агентство]
   ```

3. Суперпользователь заполняет и нажимает "Создать"
4. Система:
   - Создает агентство
   - Создает аккаунт Супер Админа
   - Привязывает Супер Админа к агентству
   - Отправляет данные для входа

5. Показывает результат:
   ```
   ✅ Агентство создано!
   
   Астана Премиум Недвижимость
   
   Руководитель: Марат Токаев
   Email: marat.tokaev@gmail.com
   
   Данные для входа отправлены на email.
   
   [OK] [К списку] [Добавить еще]
   ```

**Код создания:**

```python
def create_agency(superuser, agency_data, admin_data):
    """Создание нового агентства с руководителем"""
    
    if not superuser.is_superuser_role():
        raise PermissionError("Только суперпользователь может создавать агентства")
    
    with transaction.atomic():
        # Создаем агентство
        agency = RealEstateAgency.objects.create(
            name=agency_data['name'],
            city_id=agency_data['city_id'],
            phone=agency_data['phone'],
            email=agency_data['email'],
            description=agency_data.get('description', ''),
            commission_rate=agency_data.get('commission_rate', 10),
            properties_limit=agency_data.get('properties_limit', 0),
            realtors_limit=agency_data.get('realtors_limit', 0),
            is_active=agency_data.get('is_active', True),
            created_by=superuser
        )
        
        # Создаем Супер Админа
        super_admin = CustomUser.objects.create_user(
            username=admin_data['email'].split('@')[0],
            email=admin_data['email'],
            first_name=admin_data['first_name'],
            last_name=admin_data['last_name'],
            phone=admin_data['phone'],
            role='super_admin',
            agency=agency,
            password=admin_data.get('password', User.objects.make_random_password())
        )
        
        # Привязываем к агентству
        agency.super_admin = super_admin
        agency.save()
        
        # Логируем
        log_admin_action(
            admin=superuser,
            action='CREATE_AGENCY',
            target=agency,
            details={
                'super_admin_id': super_admin.id,
                'super_admin_email': super_admin.email
            }
        )
        
        # Отправляем уведомление
        if agency_data.get('send_credentials', True):
            send_agency_credentials_email.delay(
                agency_id=agency.id,
                admin_id=super_admin.id
            )
        
        return agency, super_admin
```

**Постусловия:**
- Новое агентство создано
- Супер Админ агентства создан и получил доступ
- Может начать добавлять риелторов и объекты

---

### Сценарий 2.3: Редактирование агентства

**Предусловия:**
- Суперпользователь авторизован
- Агентство существует

**Основной поток:**

Аналогично добавлению, но с загруженными данными. Суперпользователь может изменить любые параметры агентства.

---

### Сценарий 2.4: Деактивация агентства

**Предусловия:**
- Суперпользователь авторизован
- Агентство активно

**Основной поток (веб):**

1. Суперпользователь выбирает агентство
2. Нажимает "🚫 Деактивировать"
3. Система показывает предупреждение:
   ```
   ⚠️ ДЕАКТИВАЦИЯ АГЕНТСТВА
   
   Вы собираетесь деактивировать:
   "Астана Премиум Недвижимость"
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Что произойдет:
   
   ❌ Агентство не сможет работать
   ❌ Все риелторы будут деактивированы (8)
   ❌ Все объекты скрыты из поиска (67)
   ⚠️ Активные брони останутся (125)
   ℹ️ Данные не будут удалены
   ℹ️ Можно активировать позже
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   Причина деактивации:
   
   ( ) Нарушение правил
   ( ) Финансовые вопросы
   ( ) Неактивность
   (*) Другое
   
   Комментарий:
   [________________________________]
   [________________________________]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ☑️ Уведомить руководителя
   ☑️ Передать активные брони другому агентству
   
   Передать брони агентству:
   [Выберите агентство ▼]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [Отмена] [Деактивировать]
   ```

4. Суперпользователь заполняет и подтверждает
5. Система деактивирует агентство, риелторов и объекты
6. Опционально передает брони

**Постусловия:**
- Агентство деактивировано
- Все объекты скрыты
- Риелторы не могут войти
- Активные брони переданы (если выбрано)

---

### Сценарий 2.5: Детальная статистика агентства

**Предусловия:**
- Суперпользователь авторизован
- Выбрано агентство

**Основной поток:**

Суперпользователь видит ту же статистику, что и Супер Админ агентства (см. сценарии Супер Админа), но для любого агентства на платформе.

---

## 3. Управление пользователями

### Сценарий 3.1: Список всех пользователей

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит в "👥 Пользователи"
2. Система показывает список:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   👥 ВСЕ ПОЛЬЗОВАТЕЛИ ПЛАТФОРМЫ
   
   Всего: 15,234 пользователей
   • Гостей: 14,985
   • Риелторов: 187
   • Супер Админов: 24
   • Суперпользователей: 1
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [🔍 Поиск пользователя...]
   
   Фильтры:
   Роль: [Все ▼]
   Статус: [Все ▼]
   Регистрация: [За все время ▼]
   
   Сортировка: [По регистрации ↓]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [Таблица пользователей с пагинацией]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ```

**Постусловия:**
- Суперпользователь видит всех пользователей
- Может фильтровать и искать
- Может перейти к редактированию

---

### Сценарий 3.2: Поиск пользователя

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь вводит в поиск: телефон, email, имя или ID
2. Система ищет и показывает результаты:
   ```
   🔍 Результаты поиска: "+7 777"
   
   Найдено: 3 пользователя
   
   ┌─────────────────────────────────────┐
   │ 👤 Марат Каримов                    │
   │                                     │
   │ 📱 +7 777 123 4567                  │
   │ 📧 marat.k@email.kz                 │
   │ 🔖 Роль: Гость                      │
   │                                     │
   │ 🏠 Бронирований: 18                 │
   │ 💰 Потрачено: 450,000₸              │
   │ ⭐ Средняя оценка: 4.9              │
   │                                     │
   │ Зарегистрирован: 15.03.2024         │
   │ Последний вход: 25.10.2025          │
   │ Статус: 🟢 Активен                  │
   │                                     │
   │ [👁️ Профиль] [✏️ Редактировать]    │
   │ [🚫 Заблокировать]                  │
   └─────────────────────────────────────┘
   
   [Показать остальные...]
   ```

**Постусловия:**
- Пользователь найден
- Можно перейти к действиям

---

### Сценарий 3.3: Редактирование пользователя

**Предусловия:**
- Суперпользователь авторизован
- Пользователь существует

**Основной поток:**

Суперпользователь может изменить любые данные пользователя, включая роль, статус, контакты.

---

### Сценарий 3.4: Блокировка/разблокировка

**Предусловия:**
- Суперпользователь авторизован
- Пользователь существует

**Основной поток (веб):**

1. Суперпользователь выбирает пользователя
2. Нажимает "🚫 Заблокировать"
3. Указывает причину блокировки
4. Подтверждает
5. Пользователь не может войти в систему

**Для разблокировки:**
1. Нажимает "✅ Разблокировать"
2. Указывает причину разблокировки
3. Пользователь снова может войти

**Постусловия:**
- Пользователь заблокирован/разблокирован
- Действие залогировано
- Пользователь уведомлен (если email доступен)

---

### Сценарий 3.5: Назначение ролей

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Суперпользователь может изменить роль любого пользователя (кроме себя):
- Гость → Риелтор (с привязкой к агентству)
- Риелтор → Супер Админ (повышение)
- Супер Админ → Риелтор (понижение)
- И т.д.

**Постусловия:**
- Роль пользователя изменена
- Права доступа обновлены
- Пользователь уведомлен

---

## 4. Глобальная аналитика

### Сценарий 4.1: Общая статистика платформы

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

Расширенная версия глобального дашборда с детальной разбивкой по всем параметрам.

*(Детали см. в сценарии 1.1)*

---

### Сценарий 4.2: ТОП-5 агентств

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь выбирает "🏆 ТОП-5 агентств"
2. Система показывает:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏆 ТОП-5 АГЕНТСТВ ПЛАТФОРМЫ
   
   Период: [Текущий месяц ▼]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [💰 По доходу] [📅 По бронированиям]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🥇 ПО ДОХОДУ
   
   ┌─────────────────────────────────────┐
   │ 1. Астана Элит Недвижимость         │
   │    4,850,000₸                       │
   │                                     │
   │ 👥 8 риелторов | 🏠 67 объектов     │
   │ 📅 245 броней | ⭐ 4.7              │
   │ 📊 Загрузка: 54%                    │
   │                                     │
   │ [Детали]                            │
   └─────────────────────────────────────┘
   
   ┌─────────────────────────────────────┐
   │ 2. Алматы Премиум Хоум              │
   │    3,980,000₸                       │
   │                                     │
   │ 👥 6 риелторов | 🏠 58 объектов     │
   │ 📅 198 броней | ⭐ 4.8              │
   │ 📊 Загрузка: 62%                    │
   │                                     │
   │ [Детали]                            │
   └─────────────────────────────────────┘
   
   [3-5 места...]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ТОП-5 приносят 35% общего дохода
   (16,048,000₸ из 45,850,000₸)
   
   [📥 Экспорт] [📊 Детали]
   ```

**Постусловия:**
- Видны самые эффективные агентства
- Можно анализировать лидеров
- Можно распространять best practices

---

### Сценарий 4.3: ТОП-5 риелторов (глобально)

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь выбирает "🏆 ТОП-5 риелторов"
2. Система показывает лучших риелторов по всей платформе:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏆 ТОП-5 РИЕЛТОРОВ ПЛАТФОРМЫ
   
   Период: [Текущий месяц ▼]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [💰 По доходу] [📅 По бронированиям]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🥇 ПО ДОХОДУ
   
   ┌─────────────────────────────────────┐
   │ 1. Асем Нурланова                   │
   │    890,000₸                         │
   │                                     │
   │ 🏢 Агентство: Астана Элит           │
   │ 🏠 12 объектов | 📅 45 броней       │
   │ ⭐ 4.9 | 📊 68%                     │
   │                                     │
   │ [Детали] [Профиль]                  │
   └─────────────────────────────────────┘
   
   ┌─────────────────────────────────────┐
   │ 2. Диана Касымова                   │
   │    845,000₸                         │
   │                                     │
   │ 🏢 Агентство: Алматы Премиум        │
   │ 🏠 11 объектов | 📅 42 брони        │
   │ ⭐ 4.8 | 📊 72%                     │
   │                                     │
   │ [Детали] [Профиль]                  │
   └─────────────────────────────────────┘
   
   [3-5 места...]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ```

**Постусловия:**
- Видны лучшие риелторы
- Можно наградить/премировать
- Можно распространить их опыт

---

### Сценарий 4.4: ТОП-5 квартир (глобально)

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Аналогично ТОП-5 квартир агентства, но по всей платформе.

---

### Сценарий 4.5: ТОП-5 пользователей (глобально)

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Аналогично ТОП-5 пользователей агентства, но по всей платформе.

---

### Сценарий 4.6: География и расширение

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь выбирает "🗺️ География"
2. Система показывает:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🗺️ ГЕОГРАФИЯ ПЛАТФОРМЫ
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ОХВАТ
   
   Страна: Казахстан
   Городов: 3
   Районов: 28
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏙️ ПО ГОРОДАМ
   
   ┌─────────────────────────────────────┐
   │ 🏙️ Астана                           │
   │                                     │
   │ 🏠 Объектов: 514 (57.6%)            │
   │ 🏢 Агентств: 14                     │
   │ 👨‍💼 Риелторов: 112                   │
   │                                     │
   │ 📅 Бронирований: 1,485              │
   │ 💰 Оборот: 28,450,000₸ (62.0%)      │
   │ 📊 Загрузка: 58%                    │
   │ ⭐ Рейтинг: 4.7                     │
   │                                     │
   │ [Детали] [Карта]                    │
   └─────────────────────────────────────┘
   
   ┌─────────────────────────────────────┐
   │ 🏙️ Алматы                           │
   │                                     │
   │ 🏠 Объектов: 298 (33.4%)            │
   │ 🏢 Агентств: 8                      │
   │ 👨‍💼 Риелторов: 58                    │
   │                                     │
   │ 📅 Бронирований: 782                │
   │ 💰 Оборот: 14,280,000₸ (31.1%)      │
   │ 📊 Загрузка: 62%                    │
   │ ⭐ Рейтинг: 4.8                     │
   │                                     │
   │ [Детали] [Карта]                    │
   └─────────────────────────────────────┘
   
   ┌─────────────────────────────────────┐
   │ 🏙️ Шымкент                          │
   │                                     │
   │ 🏠 Объектов: 80 (9.0%)              │
   │ 🏢 Агентств: 2                      │
   │ 👨‍💼 Риелторов: 17                    │
   │                                     │
   │ 📅 Бронирований: 191                │
   │ 💰 Оборот: 3,120,000₸ (6.8%)        │
   │ 📊 Загрузка: 45%                    │
   │ ⭐ Рейтинг: 4.5                     │
   │                                     │
   │ [Детали] [Карта]                    │
   └─────────────────────────────────────┘
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💡 ПОТЕНЦИАЛ РАСШИРЕНИЯ
   
   Рекомендуемые города:
   1. Караганда (300k+ населения)
   2. Актобе (500k+ населения)
   3. Тараз (350k+ населения)
   
   [📊 Анализ рынка] [➕ Добавить город]
   ```

**Постусловия:**
- Видно географическое распределение
- Можно планировать расширение
- Можно анализировать региональную эффективность

---

### Сценарий 4.7: Динамика роста платформы

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь выбирает "📈 Динамика роста"
2. Система показывает:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📈 ДИНАМИКА РОСТА ПЛАТФОРМЫ
   
   Период: [Последний год ▼]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💰 РОСТ ОБОРОТА
   
        50M ┤                                   ╭─
        45M ┤                             ╭─────╯
        40M ┤                       ╭─────╯
        35M ┤                 ╭─────╯
        30M ┤           ╭─────╯
        25M ┤     ╭─────╯
        20M ┤─────╯
            └─┬────┬────┬────┬────┬────┬────┬──>
             Янв  Мар  Май  Июл  Сен  Окт  Ноя
   
   Среднемесячный рост: +12.3%
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   👥 РОСТ ПОЛЬЗОВАТЕЛЕЙ
   
      16K ┤                                   ╭─
      14K ┤                             ╭─────╯
      12K ┤                       ╭─────╯
      10K ┤                 ╭─────╯
       8K ┤           ╭─────╯
       6K ┤     ╭─────╯
       4K ┤─────╯
          └─┬────┬────┬────┬────┬────┬────┬──>
           Янв  Мар  Май  Июл  Сен  Окт  Ноя
   
   Среднемесячный рост: +8.5%
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏠 РОСТ ОБЪЕКТОВ
   
      900 ┤                                   ╭─
      800 ┤                             ╭─────╯
      700 ┤                       ╭─────╯
      600 ┤                 ╭─────╯
      500 ┤           ╭─────╯
      400 ┤     ╭─────╯
      300 ┤─────╯
          └─┬────┬────┬────┬────┬────┬────┬──>
           Янв  Мар  Май  Июл  Сен  Окт  Ноя
   
   Среднемесячный рост: +5.7%
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 КЛЮЧЕВЫЕ ВЕХИ
   
   • Янв 2024: Запуск платформы (50 объектов)
   • Мар 2024: Первое агентство-партнер
   • Май 2024: 500 пользователей
   • Июл 2024: Запуск в Алматы
   • Сен 2024: 10,000 пользователей
   • Окт 2024: 800+ объектов, Шымкент
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🎯 ПРОГНОЗ НА СЛЕДУЮЩИЙ ГОД
   
   При текущих темпах роста:
   • Оборот: ~600M₸ (+30%)
   • Пользователи: ~40K (+162%)
   • Объекты: ~2,500 (+180%)
   • Города: 6-8
   
   [📥 Экспорт отчета] [📊 Детали]
   ```

**Постусловия:**
- Виден тренд роста
- Можно планировать развитие
- Можно представить инвесторам

---

## 5. Финансы платформы

### Сценарий 5.1: Общий доход платформы

**Предусловия:**
- Суперпользователь авторизован

**Основной поток (веб):**

1. Суперпользователь заходит в "💰 Финансы"
2. Выбирает период (день/неделя/месяц/год)
3. Система показывает детализацию:
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💰 ФИНАНСЫ ПЛАТФОРМЫ
   
   Период: Октябрь 2025 (01.10 - 31.10)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📊 ОБЩИЙ ОБОРОТ
   
   45,850,000₸
   
   По сравнению с сентябрем: +18.5% ↑
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💸 СТРУКТУРА ДОХОДОВ
   
   Комиссия платформы (5%):  2,292,500₸
   Доход агентств (95%):    43,557,500₸
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   📈 ДИНАМИКА ПО ДНЯМ
   
   [График оборота по дням месяца]
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   🏢 ТОП-5 АГЕНТСТВ ПО ДОХОДУ
   
   1. Астана Элит:      4,850,000₸ (10.6%)
   2. Алматы Премиум:   3,980,000₸ (8.7%)
   3. Столичная:        3,450,000₸ (7.5%)
   4. Нур Недвижимость: 2,980,000₸ (6.5%)
   5. Алмаз Хоум:       2,750,000₸ (6.0%)
   
   Остальные (19):     27,840,000₸ (60.7%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   💳 ПО МЕТОДАМ ОПЛАТЫ
   
   Kaspi Pay:          36,680,000₸ (80%)
   Наличные:            6,877,500₸ (15%)
   Банковские карты:    2,292,500₸ (5%)
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [📥 Экспорт] [📊 Детальный отчет]
   ```

**Постусловия:**
- Виден общий финансовый оборот
- Можно анализировать структуру доходов
- Можно планировать бюджет

---

### Сценарий 5.2: Доходы по агентствам

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Детальная разбивка доходов с каждого агентства, включая комиссии платформы.

---

### Сценарий 5.3: Доходы по городам

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Сравнение доходов по городам присутствия.

---

### Сценарий 5.4: Структура комиссий

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Анализ комиссий, которые берет платформа, платежные системы, агентства.

---

### Сценарий 5.5: Финансовые прогнозы

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Прогнозирование доходов на основе трендов.

---

## 6. Управление контентом

### Сценарий 6.1: Модерация объектов

**Предусловия:**
- Суперпользователь авторизован
- Есть объекты на модерации

**Основной поток:**

Аналогично модерации Супер Админа, но для всех объектов платформы.

---

### Сценарий 6.2: Модерация отзывов

**Предусловия:**
- Суперпользователь авторизован
- Есть отзывы на модерации

**Основной поток:**

Просмотр и модерация отзывов от пользователей.

---

### Сценарий 6.3: Управление городами и районами

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Добавление новых городов и районов в систему.

---

### Сценарий 6.4: Управление типами жилья

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Добавление новых типов жилья (например, "Гостиница").

---

## 7. Аналитика качества

### Сценарий 7.1: Анализ отзывов и рейтингов

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Анализ общего качества сервиса по отзывам.

---

### Сценарий 7.2: Heat map занятости (глобальный)

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Heat map занятости по всем объектам платформы.

---

### Сценарий 7.3: История цен

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Анализ динамики цен по платформе.

---

### Сценарий 7.4: Конверсия и воронка бронирований

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Анализ воронки: поиск → просмотр → бронирование → оплата.

---

## 8. Маркетинг и продвижение

### Сценарий 8.1: Источники трафика

**Предусловия:**
- Суперпользователь авторизован
- Подключены системы аналитики

**Основной поток:**

Анализ откуда приходят пользователи.

---

### Сценарий 8.2: Эффективность рекламных каналов

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

ROI по каналам продвижения.

---

### Сценарий 8.3: Когортный анализ

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Анализ retention пользователей по когортам.

---

## 9. Безопасность и логи

### Сценарий 9.1: Журнал действий администраторов

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Просмотр всех действий Супер Админов и риелторов.

---

### Сценарий 9.2: Подозрительная активность

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Выявление подозрительных действий (попытки мошенничества, спам).

---

### Сценарий 9.3: Аудит доступа к конфиденциальным данным

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Лог доступа к чувствительным данным (коды, пароли).

---

## 10. Отчетность и экспорт

### Сценарий 10.1: Комплексные отчеты

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Генерация полных отчетов за период для руководства/инвесторов.

---

### Сценарий 10.2: Автоматические рассылки

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Настройка автоматических еженедельных/месячных отчетов.

---

### Сценарий 10.3: API для интеграций

**Предусловия:**
- Суперпользователь авторизован

**Основной поток:**

Настройка API ключей для интеграции с внешними системами (бухгалтерия, CRM).

---

## Итоговая таблица всех ролей

| Функция | Гость | Риелтор | Супер Админ | Суперпользователь |
|---------|-------|---------|-------------|-------------------|
| Поиск и бронирование | ✅ | ✅ | ✅ | ✅ |
| Управление своими объектами | ❌ | ✅ | ✅ | ✅ |
| Управление объектами риелторов | ❌ | ❌ | ✅ (своих) | ✅ (всех) |
| Управление риелторами | ❌ | ❌ | ✅ (своих) | ✅ (всех) |
| Управление агентствами | ❌ | ❌ | ❌ | ✅ |
| Статистика своих объектов | ❌ | ✅ | ✅ | ✅ |
| Статистика агентства | ❌ | ❌ | ✅ (своего) | ✅ (всех) |
| Глобальная статистика | ❌ | ❌ | ❌ | ✅ |
| Финансы агентства | ❌ | ❌ | ✅ | ✅ |
| Финансы платформы | ❌ | ❌ | ❌ | ✅ |
| Модерация контента | ❌ | ❌ | ✅ (своего) | ✅ (всего) |
| Системные настройки | ❌ | ❌ | ❌ | ✅ |
| Управление справочниками | ❌ | ❌ | ❌ | ✅ |
| Логи и безопасность | ❌ | ❌ | ❌ | ✅ |
| Мониторинг системы | ❌ | ❌ | ❌ | ✅ |

---

## Заключение

Роль **Суперпользователь** предоставляет полный контроль над платформой ЖильеGO:

✅ **Глобальное управление**
- Все агентства и пользователи
- Системные настройки
- Справочники и контент

✅ **Полная аналитика**
- Статистика по всей платформе
- Сравнение агентств и риелторов
- География и расширение
- Динамика роста

✅ **Финансовый контроль**
- Общий оборот платформы
- Комиссии и прогнозы
- ROI по каналам

✅ **Качество и безопасность**
- Модерация контента
- Мониторинг системы
- Логи и аудит

✅ **Стратегическое планирование**
- Прогнозы развития
- Анализ рынка
- Принятие решений на основе данных

---

**Дата:** 26 октября 2025  
**Версия:** 1.0  
**Статус:** ✅ Готово к разработке

**Проект ЖильеGO: Все роли завершены! 🎉**
