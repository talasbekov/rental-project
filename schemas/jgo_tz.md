# Техническое задание: Платформа посуточной аренды жилья «ЖильеGO»

В документе описаны цели, сценарии, архитектура и этапы запуска платформы краткосрочной аренды жилья. Учтены MVP‑требования и расширения на следующих итерациях. Рассмотрены конфликтные кейсы (одновременное бронирование), оплата, управление объектами, Telegram‑бот и масштабирование.

> **Важно:** Документ согласован с Use Cases. При противоречиях приоритет имеют Use Cases документы и GLOSSARY.md.

---

## Роли пользователей

Платформа поддерживает следующие роли (согласно GLOSSARY.md):

| Роль | Код | Описание | Права доступа |
|------|-----|----------|---------------|
| **Гость** | `guest` | Неавторизованный пользователь | Просмотр объектов, поиск (без бронирования) |
| **Пользователь** | `user` | Авторизованный клиент | Бронирование, оплата, отзывы, избранное |
| **Риелтор** | `realtor` | Владелец объектов | Управление своими объектами, просмотр своих бронирований, аналитика |
| **Супер Админ** | `super_admin` | Руководитель агентства | Управление командой риелторов, аналитика по команде |
| **Суперпользователь** | `superuser` | Владелец платформы | Полный доступ, глобальная аналитика, настройки |

**Примечание:** Роль "Модератор" не реализована в текущей версии. Модерация контента выполняется Суперпользователем.

---

## Статусы бронирований

Жизненный цикл бронирования (см. fsm-booking-status.puml):

1. **HOLD** (Холд) - ожидание оплаты, 15 минут
2. **CONFIRMED** (Подтверждено) - оплачено, активно
3. **CHECKED_IN** (Заселен) - гость заселился
4. **COMPLETED** (Завершено) - гость выехал
5. **CANCELLED** (Отменено) - отменено пользователем/риелтором
6. **EXPIRED** (Истек холд) - не оплачено в срок

---

## Архитектура и стек

- **Backend:** Django 5 (Python)
- **БД:** PostgreSQL
- **Хранилище медиа:** MinIO (S3‑совместимое)
- **Очереди/фоновые задачи:** Redis + Celery
- **Интеграции:** Telegram‑бот (python‑telegram‑bot)
- **Хостинг:** PS.kz

### Технические параметры:
- **Макс. размер фото:** 7 МБ (каждое)
- **Макс. количество фото:** 6 шт (на объект)
- **Холд бронирования:** 15 минут (время на оплату)
- **Метод оплаты MVP:** Kaspi Pay
- **Методы оплаты (будущее):** банковские карты, наличные

> Примечания: транзакционность, индексы по ключевым полям, кеширование повторяющихся запросов, i18n‑поддержка на будущее.

---

## Этап 1. Первый запуск (MVP, город: Астана)

### Сценарий 1. Поиск и фильтрация (Гость/Пользователь)

**Доступно для:** Гость, Пользователь, Риелтор, Супер Админ, Суперпользователь

**Шаги:**
1. Выбор города (в MVP: Астана, хранить как отдельную сущность на будущее).
2. Выбор района (справочник районов Астаны: Алматинский, Байконурский, Есильский, Сарыаркинский).
3. Класс жилья: Комфорт / Бизнес / Премиум.
4. Тип жилья: Квартира / Частный дом / Коттедж / Комната / Хостел.
5. Фильтр «Количество комнат» (для применимых типов).
6. Запуск поиска (индексы по городу, району, классу, типу, комнатам).
7. Список результатов: превью‑фото, адрес/район, тип, цена/сутки, комнаты, рейтинг.

**Рекомендации:**
- Добавить выбор дат заезда/выезда в поиск для проверки доступности.
- Расширить фильтры: диапазон цен, удобства, правила, минимальный рейтинг.
- Показ количества найденных вариантов, сообщение «ничего не найдено».
- Оптимизация запросов, кеширование популярных фильтров.
- Сортировка: по цене, рейтингу, дате добавления.

---

### Сценарий 2. Карточка объекта

**Доступно для:** Все роли

**Содержимое:**
- Название, адрес/район, класс, тип, площадь, спальные места, количество комнат.
- Галерея до 6 фото (макс. 7 МБ каждое, MinIO, оптимизация изображений).
- Описание, удобства, правила проживания.
- Цена за сутки, расчёт стоимости при выбранных датах.
- Рейтинг и количество отзывов.
- Календарь доступности (занятые даты).
- Действия:
  - **Для Гостя:** Просмотр (предложение авторизоваться для бронирования)
  - **Для Пользователя:** «Забронировать», «В избранное», «Оставить отзыв» (после завершения)
  - **Для Риелтора:** Просмотр + управление своими объектами
  - **Для Супер Админа:** Просмотр + управление объектами своих риелторов
  - **Для Суперпользователя:** Полный доступ
- (Опционально) карта с расположением.

**Контактные данные:**
- **Гость:** Не видит контакты
- **Пользователь:** Видит контакты риелтора после подтверждения бронирования (статус CONFIRMED)
- **Риелтор/Супер Админ/Суперпользователь:** Видят все контакты

**Рекомендации:**
- Поля модели: адрес, город, район, класс, тип, комнаты, описание, цена, статус, фото, удобства (M2M), правила, check‑in/out, календарь доступности.
- Коды доступа (домофон, квартира, сейф): хранить зашифрованно (AES-256), показывать только после подтверждения, логировать доступ.
- Мультимедиа: в будущем увеличить лимит фото, добавить видео/3D‑тур.
- Локализация контента (RU/KZ/EN) как задел.

---

### Сценарий 3. Бронирование (Пользователь)

**Доступно для:** Пользователь, Риелтор, Супер Админ, Суперпользователь

**Шаги:**
1. Кнопка «Забронировать»: требовать авторизацию (если Гость).
2. Выбор дат заезда/выезда.
3. Проверка доступности с учётом пересечений дат.
4. Данные гостя (минимум полей, остальное из профиля).
5. Подтверждение правил проживания.
6. Предпросмотр: объект, даты, количество суток, итоговая стоимость.
7. Создание бронирования со статусом **HOLD** (холд на 15 минут).
8. Переход к оплате.

**Защита от двойного бронирования:**
- Транзакции + `SELECT ... FOR UPDATE` при создании брони.
- Уникальные ограничения/исключающие индексы по диапазонам дат (PostgreSQL `EXCLUDE` constraint с `tsrange`).
- Блокировка дат в календаре доступности.

**Автоматическая отмена:**
- Если оплата не поступила в течение 15 минут → статус **EXPIRED**.
- Celery-задача проверки истекших холдов.
- Освобождение дат, уведомление пользователя.

---

### Сценарий 4. Оплата

**MVP (Этап 1) - только Kaspi Pay:**
- Интеграция с Kaspi Pay API.
- Создание платежной сессии, получение ссылки/QR-кода.
- Редирект пользователя на страницу оплаты Kaspi.
- Обработка webhook от Kaspi о статусе платежа.
- При успешной оплате: статус бронирования **HOLD** → **CONFIRMED**.
- При неудачной оплате: возможность повторить попытку (в течение 15 минут).

**После успешной оплаты:**
- Статус бронирования: **CONFIRMED**.
- Блокировка дат в календаре (финальная).
- Отправка подтверждения пользователю (email + Telegram).
- Отправка уведомления риелтору (email + Telegram).
- Предоставление инструкций по заселению (адрес, коды доступа).

**Комиссии (для будущей реализации):**
- Комиссия платформы: 10% от стоимости бронирования.
- Комиссия Kaspi: 2.5% от суммы транзакции.
- Риелтор получает: стоимость - комиссия платформы.

**Этап 2 (будущее):**
- Альтернативные методы: банковские карты (Visa/Mastercard через шлюз).
- Наличная оплата при заселении (статус «ожидает оплаты на месте»).
- Возврат средств при отмене (согласно политике возврата).

---

### Сценарий 5. Результат бронирования

**После подтверждения:**
- Страница «Бронь подтверждена» с:
  - Номером бронирования (UUID)
  - Информацией об объекте
  - Датами заезда/выезда
  - Итоговой суммой
  - Контактами риелтора
  - Инструкциями по заселению (адрес, подъезд, этаж, коды)
- Уведомления:
  - Email с подробной информацией
  - Telegram-сообщение с кратким подтверждением
- Кнопка «Перейти к моим бронированиям».
- (Позже) «Добавить в календарь» (Google Calendar/Outlook).

**Напоминания:**
- За 24 часа до заезда: напоминание пользователю (email + Telegram).
- В день заезда: напоминание с инструкциями.
- За 24 часа до выезда: напоминание о выезде.

---

### Сценарий 6. Текущие бронирования (Личный кабинет)

**Для Пользователя:**
- Список активных броней (статусы: CONFIRMED, CHECKED_IN):
  - Превью объекта
  - Название, адрес
  - Даты заезда/выезда
  - Статус бронирования и оплаты
  - Контакты риелтора
  - Инструкции по заселению
- Действия:
  - Просмотр деталей
  - Отмена брони (с учетом политики отмены)
  - Связь с риелтором
- Безопасность: фильтрация по `request.user`.

**Для Риелтора:**
- Список бронирований **только своих объектов**.
- Фильтры: по статусу, датам, объекту.
- Действия:
  - Просмотр деталей брони
  - Отмена брони (с причиной)
  - Контакты гостя
  - Отметка о заселении (CONFIRMED → CHECKED_IN)
  - Отметка о выселении (CHECKED_IN → COMPLETED)

**Для Супер Админа:**
- Список бронирований **объектов своих риелторов**.
- Агрегированная статистика по команде.
- Все действия риелтора + управление командой.

**Для Суперпользователя:**
- Все бронирования платформы.
- Глобальная статистика.
- Полный контроль.

---

### Сценарий 7. История бронирований

**Для Пользователя:**
- Завершённые (COMPLETED) и отменённые (CANCELLED) брони.
- Детализация: объект, даты, сумма, статус.
- После завершения (COMPLETED):
  - Кнопка «Оставить отзыв».
  - Возможность повторного бронирования.
- (Позже) экспорт/печать чеков.

**Для Риелтора:**
- История бронирований своих объектов.
- Статистика: доходы, загрузка, популярность объектов.
- Причины отмен.

**Для Супер Админа:**
- История бронирований объектов своей команды.
- Детальная аналитика по команде риелторов.

---

### Сценарий 8. Избранное (Пользователь)

**Доступно для:** Авторизованные пользователи (User, Realtor, Super Admin, Superuser)

**Функциональность:**
- Иконка «Сердце» в списке объектов и на карточке.
- Добавление/удаление объектов в избранное (M2M User↔Property).
- Страница «Избранное» со списком сохраненных объектов:
  - Превью-фото
  - Название, адрес
  - Цена
  - Рейтинг
  - Кнопка «Забронировать»
  - Кнопка «Удалить из избранного»
- Синхронизация между веб-интерфейсом и Telegram-ботом.
- (Будущее) Уведомления об изменении цены или освобождении дат.

**Безопасность:**
- Авторизация обязательна.
- Гостям при попытке добавить в избранное предлагается зарегистрироваться.

---

### Сценарий 9. Панель риелтора

**Доступно для:** Риелтор, Супер Админ, Суперпользователь

**Функциональность для Риелтора:**

#### 9.1. Управление объектами

**Добавление объекта (MVP):**
- Форма добавления:
  - Название объекта
  - Город (Астана)
  - Район (выбор из справочника)
  - Класс жилья (Комфорт/Бизнес/Премиум)
  - Тип жилья (Квартира/Дом/Коттедж/Комната/Хостел)
  - Количество комнат
  - Адрес (улица, дом, корпус/строение)
  - Подъезд, этаж, общее количество этажей
  - Площадь (м²)
  - Спальные места
  - Описание (текстовое поле)
  - Удобства (множественный выбор: Wi-Fi, парковка, кухня и т.д.)
  - Правила проживания
  - Цена за сутки (тенге)
  - Время заезда/выезда
  - Фотографии (до 6 шт, макс 7 МБ каждое)
  - **Конфиденциальная информация (зашифрованно):**
    - Код домофона
    - Код от квартиры
    - Код от сейфа (опционально)
  - Телефон риелтора
  - (Опционально) Координаты на карте
- Валидация полей, превью фотографий.
- Сохранение: статус объекта «Активен», доступен для бронирования.

**Редактирование объекта (Этап 2):**
- Изменение любых полей объекта.
- Управление фотографиями (добавление, удаление, изменение порядка).
- Выбор главной фотографии.
- Деактивация/активация объекта.
- Аудит изменений (кто, когда, что изменил).

**Блокировка дат:**
- Календарь доступности объекта.
- Выбор диапазона дат для блокировки.
- Причины блокировки:
  - Техническое обслуживание
  - Ремонт
  - Личное использование
  - Другое
- Блокированные даты недоступны для бронирования.

**Список объектов:**
- Отображение всех объектов риелтора.
- Фильтры: по статусу, типу, району.
- Сортировка: по дате добавления, цене, загрузке.
- Быстрые действия: редактировать, деактивировать, посмотреть бронирования.

#### 9.2. Управление бронированиями

**Список бронирований:**
- Все бронирования объектов риелтора.
- Фильтры: по статусу, объекту, датам.
- Информация: гость, объект, даты, статус, сумма.

**Действия:**
- Просмотр деталей брони и контактов гостя.
- Отмена бронирования (с указанием причины).
- Отметка о заселении (CONFIRMED → CHECKED_IN).
- Отметка о выселении (CHECKED_IN → COMPLETED).
- Инициирование возврата средств (при отмене).

**Уведомления:**
- Telegram/Email при новом бронировании.
- Напоминания о предстоящих заездах.

#### 9.3. Аналитика (только по своим объектам)

**Доступные метрики:**
- Доходы за период (неделя/месяц/год)
- Топ-5 своих квартир по:
  - Доходу
  - Числу бронирований
- Топ-5 своих клиентов по:
  - Количеству заселений
  - Сумме трат
- Загрузка объектов (процент занятых ночей)
- Причины отмен бронирований
- Heat map занятости объектов
- История изменения цен

**Экспорт:**
- CSV/XLSX отчеты.
- Выбор периода.

#### 9.4. Профиль и настройки

- Редактирование профиля (имя, телефон, email).
- Настройки уведомлений.
- Смена пароля.
- Двухфакторная аутентификация (2FA).

**Безопасность:**
- Доступ к кодам объектов логируется.
- Коды хранятся зашифрованно (AES-256).
- История действий (аудит-лог).

---

### Сценарий 10. Панель Супер Админа

**Доступно для:** Супер Админ (руководитель агентства)

**Все возможности Риелтора +**

#### 10.1. Управление командой риелторов

**Список риелторов:**
- Отображение всех риелторов своего агентства.
- Информация: ФИО, email, телефон, количество объектов, доход.
- Статус: активен/деактивирован.

**Действия:**
- Добавление нового риелтора в команду.
- Редактирование профиля риелтора.
- Деактивация/активация риелтора.
- Просмотр активности риелтора.

**Назначение риелтора:**
- При добавлении риелтора он автоматически привязывается к агентству Супер Админа.
- Риелтор видит только свои объекты.
- Супер Админ видит объекты всех своих риелторов.

#### 10.2. Управление объектами команды

**Просмотр объектов:**
- Список всех объектов риелторов своей команды.
- Фильтры: по риелтору, району, типу, статусу.

**Действия:**
- Добавление объектов от имени риелторов.
- Редактирование объектов риелторов (логируется).
- Просмотр календаря доступности.
- **Доступ к кодам объектов** (с обязательным логированием).

#### 10.3. Управление бронированиями команды

**Список бронирований:**
- Все бронирования объектов всех риелторов команды.
- Фильтры: по риелтору, объекту, статусу, датам.

**Действия:**
- Все действия риелтора.
- Отмена бронирований от имени команды.
- Инициирование возвратов.

#### 10.4. Агрегированная аналитика по команде

**Доступные метрики:**
- Доходы команды за период (день/неделя/месяц/год)
- Топ-5 квартир команды по доходу/бронированиям
- Топ-5 клиентов команды
- **Топ-5 риелторов своего агентства** по:
  - Доходу
  - Количеству бронирований
- Список риелторов с доходом за месяц (с пагинацией)
- Загрузка объектов команды (%)
- Причины отмен по команде
- Heat map занятости команды

**Сравнительная аналитика:**
- Сравнение показателей риелторов.
- Динамика доходов по месяцам.
- Эффективность работы команды.

**Экспорт:**
- CSV/XLSX отчеты по команде.
- Детализированные отчеты по каждому риелтору.

**Ограничения:**
- Супер Админ НЕ видит:
  - Объекты других агентств
  - Глобальную аналитику платформы
  - Риелторов других агентств

---

### Сценарий 11. Панель Суперпользователя

**Доступно для:** Superuser (владелец платформы)

**Полный доступ ко всей системе:**

#### 11.1. Глобальное управление

**Пользователи:**
- Просмотр всех пользователей, риелторов, супер админов.
- Назначение и изменение ролей.
- Блокировка/разблокировка пользователей.
- Просмотр истории активности.

**Объекты:**
- Просмотр всех объектов на платформе.
- Управление любыми объектами.
- Модерация новых объявлений (если требуется).

**Бронирования:**
- Все бронирования платформы.
- Управление любыми бронированиями.
- Разрешение конфликтов.

#### 11.2. Глобальная аналитика

**Платформа:**
- Общие доходы платформы за период.
- Комиссии платформы и платежных систем.
- Количество пользователей, риелторов, агентств.
- Количество объектов, бронирований.

**Рейтинги:**
- Топ-5 квартир по всей платформе
- Топ-5 пользователей по всей платформе
- Топ-5 риелторов по всей платформе
- **Топ-5 агентств** (Супер Админов) по доходу
- Список всех агентств с доходом

**Аналитика по агентствам:**
- Детальная статистика каждого агентства.
- Сравнение агентств.
- Динамика роста.

**Экспорт:**
- Любые отчеты в CSV/XLSX/PDF.
- Автоматические ежемесячные отчеты.

#### 11.3. Модерация контента

**Отзывы:**
- Просмотр всех отзывов.
- Удаление неподобающих отзывов.
- Блокировка пользователей за спам.

**Объявления:**
- Модерация новых объявлений (опционально).
- Деактивация некорректных объявлений.

#### 11.4. Системное администрирование

**Настройки:**
- Настройки платформы (комиссии, правила, политики).
- Управление справочниками (города, районы, типы жилья, удобства).
- Интеграции (Kaspi Pay, Telegram, Email).

**Безопасность:**
- Просмотр всех логов доступа.
- Аудит действий всех администраторов.
- Настройки безопасности (2FA, IP-ограничения).

**Техническое:**
- Доступ к Django Admin.
- Резервное копирование.
- Мониторинг производительности.

---

## Этап 2. Расширение функциональности

### География и поиск по городам

- Справочник городов Казахстана.
- Мультигородовой поиск.
- Локализация UI (русский, казахский, английский).
- Региональные настройки (валюта, часовой пояс).

### Новые типы жилья, гостиницы

**Тип «Гостиница»:**
- **Простой путь:** Каждый номер как отдельный объект (привязка к гостинице через тег/категорию).
- **Продвинутый:** Сущности «Гостиница» (1) и «Номер» (N):
  - Гостиница: название, адрес, описание, общие удобства, фото.
  - Номер: категория, количество, цена, специфичные удобства.
  - В карточке гостиницы — выбор категории номера, проверка доступности.

**Комната/Хостел:**
- Специфичные поля: количество коек, тип размещения (общая/приватная), правила хостела.

### Онлайн‑оплата (расширение)

**Kaspi Pay (улучшение):**
- Оптимизация интеграции.
- Обработка всех edge-cases.
- Idempotency keys для повторных запросов.
- Тестовая среда для разработки.

**Дополнительные методы:**
- Банковские карты: Visa/Mastercard через шлюз (Stripe/PayBox).
- Наличная оплата: статус «Ожидает оплаты на месте», подтверждение риелтором.
- Оплата частями (рассрочка) - будущее.

**Возвраты:**
- Автоматический возврат через API платежной системы.
- Политика возврата (100% за 24ч до заезда, 50% за 12ч, 0% позже).
- Учет комиссий при возврате.

### Устойчивость к конкуренции

**Календарь доступности:**
- UI-календарь занятости на карточке объекта (для всех пользователей).
- Интерактивный календарь в панели риелтора (управление блокировками).
- Синхронизация с внешними календарями (Google Calendar, iCal) - будущее.

**Проверка доступности:**
- Обязательная проверка при поиске (фильтрация занятых объектов).
- Проверка при открытии карточки (актуальность).
- Проверка при создании брони (финальная, с блокировкой).

**Защита от гонок:**
- Транзакции + `SELECT ... FOR UPDATE`.
- PostgreSQL EXCLUDE constraints с tsrange.
- Pessimistic locking при высоких нагрузках.
- Optimistic locking для редактирования (version field).

**Фоновые задачи (Celery):**
- Автоматическая отмена истекших холдов (каждую минуту).
- Отправка уведомлений (асинхронно).
- Генерация отчетов (по расписанию).
- Очистка старых данных (архивация).

### Отзывы и рейтинги

**Функциональность:**
- Пользователь может оставить отзыв после завершения бронирования (COMPLETED).
- Форма отзыва:
  - Оценка (1-5 звезд)
  - Комментарий (текст)
  - Фотографии (опционально, до 3 шт)
- Риелтор может ответить на отзыв.
- Отображение среднего рейтинга на карточке объекта.
- Список отзывов с фильтрацией и сортировкой.

**Модерация:**
- Автоматическая модерация (фильтр мата и спама).
- Ручная модерация Суперпользователем (при необходимости).
- Возможность пожаловаться на отзыв.

### Telegram‑бот (расширение)

**Текущая функциональность:**
- Регистрация/авторизация через Telegram.
- Поиск объектов через диалог (город, район, класс, тип, комнаты).
- Просмотр карточек объектов с фото (альбомы).
- Бронирование через бота.
- Оплата: ссылка на Kaspi Pay.
- Уведомления: подтверждения, напоминания.
- Команды: /start, /help, /search, /mybookings, /favorites.

**Расширения:**
- Inline-кнопки для быстрого выбора фильтров.
- Сохранение предпочтений пользователя.
- Рекомендации объектов.
- Чат с поддержкой через бота.

**Для риелторов:**
- Уведомления о новых бронированиях.
- Быстрый просмотр текущих бронирований.
- Короткие отчеты (доходы за день/неделю).
- Команды: /stats, /bookings, /properties.

### Прочие улучшения

**UX/UI:**
- Адаптивный дизайн (mobile-first).
- Улучшенная навигация.
- Breadcrumbs, фильтры с сохранением состояния.
- Прогрессивное веб-приложение (PWA).

**SEO:**
- Мета-теги (title, description, keywords).
- ЧПУ-URL (человекопонятные URLs).
- XML Sitemap.
- Structured data (schema.org).
- Производительность (Core Web Vitals).

**Медиа:**
- Автоматическая оптимизация изображений (сжатие, WebP).
- Генерация превью разных размеров.
- Ленивая загрузка (lazy loading).
- CDN для статики.
- Очистка неиспользуемых файлов (Celery-задача).

**Мониторинг и логирование:**
- Интеграция с Sentry (ошибки).
- Интеграция с Prometheus/Grafana (метрики).
- Структурированное логирование.
- Алерты при критических ошибках.

**Резервное копирование:**
- Автоматические бэкапы PostgreSQL (ежедневно).
- Резервное копирование MinIO (инкрементально).
- Хранение в удаленном хранилище.
- Регулярное тестирование восстановления.

---

## Этап 3. Перспективные функции

### Кабинеты владельцев (расширенные)

**Если владелец != риелтор (агентская модель):**
- Отдельная роль "Владелец" с ограниченными правами.
- Владелец может:
  - Добавлять свои объекты.
  - Просматривать бронирования своих объектов.
  - Получать payouts (выплаты).
- Риелтор (агент) управляет объектами владельцев:
  - Модерация объявлений.
  - Управление бронированиями.
  - Коммуникация с гостями.

**Payouts (выплаты):**
- Автоматический расчет выплат (доход - комиссия).
- График выплат (еженедельно/ежемесячно).
- История выплат.
- Интеграция с банковскими API для автоматических переводов.

### Динамическое ценообразование

**Ценовой календарь:**
- Риелтор может устанавливать разные цены на разные даты.
- Повышенные цены на выходные/праздники.
- Скидки на длительное проживание.

**Smart Pricing (будущее):**
- Автоматические рекомендации цен на основе:
  - Спроса (загрузка аналогичных объектов).
  - Сезонности.
  - Событий в городе.
  - Конкурентов.

### Акции и купоны

**Промо-коды:**
- Создание промо-кодов (фиксированная скидка или процент).
- Ограничения: срок действия, минимальная сумма, количество использований.
- Отслеживание эффективности.

**Программа лояльности:**
- Накопительные баллы за бронирования.
- Скидки для постоянных клиентов.
- Реферальная программа.

### Встроенный чат

**Гость ↔ Риелтор:**
- Чат для уточнения деталей бронирования.
- Отправка фото/документов.
- Уведомления о новых сообщениях.

**Гость ↔ Поддержка:**
- Техническая поддержка.
- Помощь при возникновении проблем.
- FAQ и чат-бот для типовых вопросов.

### Мобильные приложения

**Native приложения (iOS/Android):**
- React Native или Flutter.
- Все функции веб-версии.
- Push-уведомления.
- Биометрическая аутентификация.

**PWA (Progressive Web App):**
- Установка как приложение.
- Работа офлайн (кеширование).
- Push-уведомления (Web Push).

### Публичное API

**REST API (Django REST Framework):**
- Документация (Swagger/OpenAPI).
- Аутентификация (JWT tokens).
- Rate limiting.
- Webhook'и для партнеров.

**Use cases:**
- Интеграция с внешними системами.
- Мобильные приложения третьих сторон.
- Агрегаторы недвижимости.

### Масштабирование

**Горизонтальное масштабирование:**
- Контейнеризация (Docker).
- Оркестрация (Kubernetes).
- Балансировка нагрузки (Nginx/HAProxy).

**Кеширование:**
- Redis для сессий и кеша.
- Кеширование популярных запросов.
- CDN для статики и медиа.

**База данных:**
- Read replicas для чтения.
- Шардирование при необходимости.
- Connection pooling (PgBouncer).

**Поиск:**
- Elasticsearch для полнотекстового поиска.
- PostGIS для гео-поиска.
- Индексация всех объектов.

**Мониторинг:**
- APM (Application Performance Monitoring).
- Логирование в centralized storage (ELK stack).
- Алерты и SLA.

### Интеграции

**Property Management Systems (PMS):**
- Синхронизация с системами управления отелями.
- Импорт/экспорт бронирований.
- Двусторонняя синхронизация календарей.

**Верификация:**
- Верификация пользователей (KYC).
- Верификация объектов (фото, документы).
- Значки "Проверено" для надежных хостов.

**Платежи:**
- Интеграция с дополнительными платежными системами.
- Криптовалюты (опционально).
- Международные платежи.

---

## Заключение

**MVP (Этап 1)** покрывает:
- Поиск и фильтрацию в одном городе (Астана).
- Детальные карточки объектов с фото и описанием.
- Бронирование с защитой от двойного бронирования.
- Оплату через Kaspi Pay.
- Личные кабинеты для пользователей и риелторов.
- Панель риелтора для управления объектами.
- Базовую аналитику.

**Этап 2** приносит:
- Онлайн-эквайринг (Kaspi Pay оптимизация + альтернативы).
- Мультигород и новые типы жилья.
- Улучшенную надёжность (календари, транзакции).
- Роли и иерархию (Риелтор → Супер Админ → Суперпользователь).
- Расширенный Telegram-бот.
- Отзывы и рейтинги.

**Этап 3** (перспектива):
- Динамическое ценообразование.
- Акции и программы лояльности.
- Кабинеты владельцев с payouts.
- Встроенный чат.
- Мобильные приложения (native/PWA).
- Публичное API.
- Масштабирование и интеграции.

**Ключевые требования:**
- **Удобство:** Интуитивный интерфейс для всех ролей.
- **Безопасность:** Шифрование данных, 2FA, логирование доступа к конфиденциальной информации.
- **Надежность:** Транзакционная целостность, защита от двойного бронирования.
- **Масштабируемость:** Архитектура, готовая к росту.
- **Аудит:** Логирование всех критичных действий.
- **Производительность:** Оптимизация запросов, кеширование, индексы.

---

## Соответствие Use Cases

Данное ТЗ полностью согласовано со следующими документами:
- `JGO_User_cases.md` - Use cases для пользователей и гостей
- `JGO_Realtor_cases.md` - Use cases для риелторов
- `JGO_SuperAdmin_Cases.md` - Use cases для супер админов
- `JGO_Superuser_Cases.md` - Use cases для суперпользователей
- `GLOSSARY.md` - Единый глоссарий терминов
- `МАТРИЦА_ПРАВ_ДОСТУПА.md` - Матрица прав доступа
- `fsm-booking-status.puml` - FSM диаграмма статусов бронирований

При любых противоречиях между документами **приоритет имеют Use Cases**.

---

## Ссылки и ресурсы

### Документация проекта:
- `/docs/use-cases/` - Use Cases для всех ролей
- `/docs/reference/GLOSSARY.md` - Глоссарий терминов
- `/docs/reference/МАТРИЦА_ПРАВ_ДОСТУПА.md` - Матрица прав доступа
- `/docs/diagrams/fsm-booking-status.puml` - FSM диаграмма статусов
- `/docs/diagrams/c4-contaxt-diagram.puml` - C4 Context диаграмма

### Внешние ресурсы:
1. The Ultimate Guide on How to develop Your Own Airbnb Clone: <https://medium.com/@creolestudios/the-ultimate-guide-on-how-to-develop-your-own-airbnb-clone-ffa42edd5d89>
2. Handling the Double-Booking Problem in Databases: <https://adamdjellouli.com/articles/databases_notes/07_concurrency_control/04_double_booking_problem>
3. Django Documentation: <https://docs.djangoproject.com/>
4. PostgreSQL Exclusion Constraints: <https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-EXCLUSION>
5. Kaspi Pay API Documentation: (внутренняя документация)

---

**Версия документа:** 2.0  
**Дата обновления:** 26 октября 2025  
**Статус:** ✅ СОГЛАСОВАНО С USE CASES  
**Следующее обновление:** После завершения MVP
